<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload='this.media="all"'><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="wugengfeng"><meta name="keywords" content="wugengfeng"><meta name="description" content="UML  类图 参考文章：https:&#x2F;&#x2F;cloud.tencent.com&#x2F;developer&#x2F;article&#x2F;1012684  箭头方向  子类指向父类  定义子类时需要通过extends关键字指定父类 子类一定是知道父类定义的,但父类并不知道子类的定义 只有知道对方信息时才能指向对方 所以箭头方向是从子类指向父类  继承（泛化） 三角箭头-实线  实现 三角箭头-虚线  依赖 箭头-虚线"><meta property="og:type" content="article"><meta property="og:title" content="设计模式"><meta property="og:url" content="https://wugengfeng.cn/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/index.html"><meta property="og:site_name" content="技术博客"><meta property="og:description" content="UML  类图 参考文章：https:&#x2F;&#x2F;cloud.tencent.com&#x2F;developer&#x2F;article&#x2F;1012684  箭头方向  子类指向父类  定义子类时需要通过extends关键字指定父类 子类一定是知道父类定义的,但父类并不知道子类的定义 只有知道对方信息时才能指向对方 所以箭头方向是从子类指向父类  继承（泛化） 三角箭头-实线  实现 三角箭头-虚线  依赖 箭头-虚线"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://wugengfeng.cn/img/banner/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.png"><meta property="article:published_time" content="2022-04-22T16:41:55.000Z"><meta property="article:modified_time" content="2023-07-14T06:49:18.196Z"><meta property="article:author" content="wugengfeng"><meta property="article:tag" content="wugengfeng"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://wugengfeng.cn/img/banner/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.png"><meta name="baidu-site-verification" content="codeva-uJ0fkFPmHB"><title>设计模式 - 技术博客</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/custom.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var dntVal,CONFIG={hostname:"wugengfeng.cn",root:"/",version:"1.9.3",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!1,element:"h9",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:1},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"};CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="技术博客" type="application/atom+xml"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>吴耿锋</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/banner/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8Fbanner.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="设计模式"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-04-23 00:41" pubdate>2022年4月23日 凌晨</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 63k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 524 分钟</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">设计模式</h1><div class="markdown-body"><h2 id="uml"><a class="markdownIt-Anchor" href="#uml"></a> UML</h2><h3 id="类图"><a class="markdownIt-Anchor" href="#类图"></a> 类图</h3><p>参考文章：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1012684">https://cloud.tencent.com/developer/article/1012684</a></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/UML%E5%85%B3%E7%B3%BB%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p class="note note-primary">箭头方向</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%AE%AD%E5%A4%B4%E6%96%B9%E5%90%91.png" srcset="/img/loading.gif" lazyload alt></p><p><code>子类指向父类</code></p><ul><li>定义子类时需要通过extends关键字指定父类</li><li>子类一定是知道父类定义的,但父类并不知道子类的定义</li><li>只有知道对方信息时才能指向对方</li><li>所以箭头方向是从子类指向父类</li></ul><p class="note note-primary">继承（泛化）</p><p><code>三角箭头-实线</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%AE%9E%E7%BA%BF.png" srcset="/img/loading.gif" lazyload alt></p><p class="note note-primary">实现</p><p><code>三角箭头-虚线</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%99%9A%E7%BA%BF.png" srcset="/img/loading.gif" lazyload alt></p><p class="note note-primary">依赖</p><p><code>箭头-虚线</code></p><p><code>一个类用到了另一个类。这种使用关系是具有偶然性的、临时性的、非常弱的</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BE%9D%E8%B5%96.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">study</span><span class="hljs-params">(Book book)</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;看书&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p class="note note-primary">关联</p><p><code>箭头-实线</code></p><p><code>关联关系，即强调了“使用”，例如人和车的关系</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB.png" srcset="/img/loading.gif" lazyload alt></p><p><code>idea插件</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%85%B3%E8%81%94.png" srcset="/img/loading.gif" lazyload alt></p><p class="note note-primary">聚合</p><p><code>空心菱形</code></p><p><code>更强调整体与部分,整体与部分不是同生共死的</code></p><p><strong>数字的含义</strong></p><ul><li>0…1: 0或1个实例.</li><li>0…<em>: 0或多个实例.</em></li><li><em>1…1: 1个实例.</em></li><li><em>1只能有一个实例.</em></li><li><em>1…</em>: 至少有一个实例.</li></ul><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%81%9A%E5%90%88.png" srcset="/img/loading.gif" lazyload alt></p><p><em>IDEA插件是实心菱形加虚线箭头</em></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%A9%BA%E5%BF%83%E8%8F%B1%E5%BD%A2.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">School</span> &#123;<br>    <span class="hljs-keyword">private</span> List&lt;Student&gt; students ;<br><br>    <span class="hljs-keyword">public</span> List&lt;Student&gt; <span class="hljs-title function_">getStudents</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> students;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStudents</span><span class="hljs-params">(List&lt;Student&gt; students)</span> &#123;<br>        <span class="hljs-built_in">this</span>.students = students;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>聚合：代表空器皿里可以放很多相同东西，聚在一起（箭头方向所指的类）</p><ul><li>整体和局部的关系，两者有着独立的生命周期，是has a的关系</li><li>弱关系</li></ul><p class="note note-primary">组合</p><p><code>实心菱形</code></p><p><code>更强调整体与部分,整体与部分是同生共死的</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%AE%9E%E5%BF%83%E8%8F%B1%E5%BD%A22.png" srcset="/img/loading.gif" lazyload alt></p><p><em>IDEA插件是实心菱形加虚线箭头加create</em></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%AE%9E%E5%BF%83%E8%8F%B1%E5%BD%A2.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Computer</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Cpu</span> <span class="hljs-variable">cpu</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cpu</span>();<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Gpu</span> <span class="hljs-variable">gpu</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Gpu</span>();<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cpu</span> &#123;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Gpu</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>整体与局部的关系，和聚合的关系相比，关系更加强烈两者有相同的生命周期，contains-a的关系</li><li>强关系</li></ul><p class="note note-primary">访问修饰符</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/UML%E8%AE%BF%E9%97%AE%E4%BF%AE%E9%A5%B0%E7%AC%A6.png" srcset="/img/loading.gif" lazyload alt></p><table><thead><tr><th style="text-align:left">访问修饰符</th><th style="text-align:left">符号</th></tr></thead><tbody><tr><td style="text-align:left">public</td><td style="text-align:left">+</td></tr><tr><td style="text-align:left">protected</td><td style="text-align:left">#</td></tr><tr><td style="text-align:left">default</td><td style="text-align:left">~</td></tr><tr><td style="text-align:left">private</td><td style="text-align:left">-</td></tr><tr><td style="text-align:left">抽象属性</td><td style="text-align:left">下划线标注</td></tr><tr><td style="text-align:left">抽象方法</td><td style="text-align:left">斜体</td></tr></tbody></table><p><code>idea插件表示</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BF%AE%E9%A5%B0%E7%AC%A6%E5%8F%B7.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> id;<br>    <span class="hljs-keyword">protected</span> String name;<br>    <span class="hljs-type">int</span> age;<br>    <span class="hljs-keyword">private</span> String address;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String sex;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getAddress</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> address;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getSex</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> sex;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> String <span class="hljs-title function_">abstractFun</span><span class="hljs-params">(<span class="hljs-type">int</span> a)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="软件设计七大原则"><a class="markdownIt-Anchor" href="#软件设计七大原则"></a> 软件设计七大原则</h2><p>参考文章：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1650116">https://cloud.tencent.com/developer/article/1650116</a></p><p>参考文章：<a target="_blank" rel="noopener" href="https://juejin.cn/post/7027666637964705806">https://juejin.cn/post/7027666637964705806</a></p><p>参考文章：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903795017646094#heading-20">https://juejin.cn/post/6844903795017646094#heading-20</a></p><h2 id="设计模式"><a class="markdownIt-Anchor" href="#设计模式"></a> 设计模式</h2><p>参考文章：<a target="_blank" rel="noopener" href="https://pdai.tech/md/dev-spec/pattern/3_simple_factory.html">https://pdai.tech/md/dev-spec/pattern/3_simple_factory.html</a></p><p>参考文章：<a target="_blank" rel="noopener" href="https://refactoringguru.cn">https://refactoringguru.cn</a></p><p class="note note-primary">创建型</p><table><thead><tr><th>设计模式</th><th>定义</th><th>适用场景</th></tr></thead><tbody><tr><td><a href="#%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82">简单工厂</a></td><td>根据不同的参数创建不同的产品</td><td>工厂类负责创建的对象较少</td></tr><tr><td><a href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95">工厂方法</a></td><td>定义一个创建对象的接口，允许子类决定<br>实例化对象的类型</td><td>创建对象需要大量重复的代码（产品等级）</td></tr><tr><td><a href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82">抽象工厂</a></td><td>抽象工厂模式提供一个创建一系列相关或<br>相互依赖对象的接口</td><td>强调一系列相关的产品对象(属于同一产品族)<br>一起使用创建对象需要大量重复的代码</td></tr><tr><td><a href="#%E5%BB%BA%E9%80%A0%E8%80%85">建造者</a></td><td>将一个复杂对象的构建与它的表示分离，<br>使得同样的构建过程可以创建不同的表示</td><td>一个对象有非常复杂的内部结构</td></tr><tr><td><a href="#%E5%8E%9F%E5%9E%8B">原型</a></td><td>指原型实例指定创建对象的种类，并且通<br>过拷贝这些原型创建新的对象</td><td>类初始化消耗较多资源；循环体中生产大量对象时</td></tr><tr><td><a href="#%E5%8D%95%E4%BE%8B">单例</a></td><td>保证一个类只有一个实例</td><td>程序中的某个类对于所有客户端只有一个可用的实<br>例，可以使用单例模式</td></tr></tbody></table><p class="note note-primary">结构型</p><table><thead><tr><th>设计模式</th><th>定义</th><th>适用场景</th></tr></thead><tbody><tr><td><a href="#%E5%A4%96%E8%A7%82%EF%BC%88%E9%97%A8%E9%9D%A2%EF%BC%89">外观（门面）</a></td><td>提供了一个统一的接口，用来访问<br>子系统中的一群接口</td><td>构建多层系统结构，利用外观对象作为每<br>层的入口，简化层间调用</td></tr><tr><td><a href="#%E8%A3%85%E9%A5%B0%E8%80%85">装饰者</a></td><td>不改变原有对象的基础之上，将功<br>能附加到对象上</td><td>扩展一个类的功能或给一个类添加附加职责</td></tr><tr><td><a href="#%E9%80%82%E9%85%8D%E5%99%A8">适配器</a></td><td>将一个类的接口转换成客户期望的<br>另一个接口</td><td>已经存在的类，它的方法和需求不匹配时</td></tr><tr><td><a href="#%E4%BA%AB%E5%85%83">享元</a></td><td>通过共享多个对象所共有的相同状态，<br>在有限的内存容量中载入更多对象</td><td>系统有大量相似对象、需要缓冲池的场景</td></tr><tr><td><a href="#%E7%BB%84%E5%90%88">组合</a></td><td>使客户端对单个对象和组合对象保持一<br>致的方式处理</td><td>需要实现树状对象结构， 可以使用组合模式</td></tr><tr><td><a href="#%E6%A1%A5%E6%8E%A5">桥接</a></td><td>可将一个大类或一系列紧密相关的类拆分<br>为抽象和实现两个独立的层次结构， 从而<br>能在开发时形成多维度的扩展体系</td><td>希望在几个独立维度上扩展一<br>个类， 可使用该模式</td></tr><tr><td><a href="%E4%BB%A3%E7%90%86">代理</a></td><td>为其他对象提供一种代理，以控制对这个<br>对象的访问</td><td>保护目标对象；增强目标对象</td></tr></tbody></table><p class="note note-primary">行为型</p><table><thead><tr><th>设计模式</th><th>定义</th><th>适用场景</th></tr></thead><tbody><tr><td><a href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95">模板方法</a></td><td>它在超类中定义了一个算法的框架， 允许<br>子类在不修改结构的情况下重写算法的特定<br>步骤</td><td>希望客户端扩展某个特定算法步骤，<br>而不是整个算法或其结构时， 可使<br>用模板方法模式</td></tr><tr><td><a href="#%E8%BF%AD%E4%BB%A3%E5%99%A8">迭代器</a></td><td>提供一种方法，顺序访问一个集合对象中的<br>各个元素，而又不暴露该对象的内部表示</td><td>希望代码能够遍历不同的甚至是无法预<br>知的数据结构， 可以使用迭代器模式</td></tr><tr><td><a href="#%E7%AD%96%E7%95%A5">策略</a></td><td>它能让你定义一系列算法， 并将每种算法分<br>别放入独立的类中， 以使算法的对象能够相互替换</td><td>当你想使用对象中各种不同的算法变体<br>， 并希望能在运行时切换算法时， 可<br>使用策略模式</td></tr><tr><td><a href="#%E8%A7%A3%E9%87%8A%E5%99%A8">解释器</a></td><td>为了解释一种语言，而为语言创建的解释器</td><td>（低频）某个特定类型问题发生频率足<br>够高</td></tr><tr><td><a href="#%E8%A7%82%E5%AF%9F%E8%80%85">观察者</a></td><td>定义一种订阅机制， 可在对象事件发生时<br>通知多个 “观察” 该对象的其他对象</td><td>关联行为场景，建立一套触发机制</td></tr><tr><td><a href="#%E5%A4%87%E5%BF%98%E5%BD%95">备忘录</a></td><td>保存一个对象的某个状态，以便在适当的<br>时候恢复对象</td><td>保存及恢复数据相关业务场景（binlog）</td></tr><tr><td><a href="#%E5%91%BD%E4%BB%A4">命令</a></td><td>将请求转换为一个包含与请求相关的所有信<br>息的独立对象，该转换让你能根据不同的请<br>求将方法参数化、 延迟请求执行或将其放入队<br>列中， 且能实现可撤销操作</td><td>想要将操作放入队列中、 操作的执行<br>或者远程执行操作， 可使用命令模式</td></tr><tr><td><a href="#%E4%B8%AD%E4%BB%8B%E8%80%85">中介者</a></td><td>减少对象之间混乱无序的依赖关系。 该模式<br>会限制对象之间的直接交互， 迫使它们通过<br>一个中介者对象进行合作</td><td>当一些对象和其他对象紧密耦合以致<br>难以对其进行修改时， 可使用中介者<br>模式</td></tr><tr><td><a href="#%E8%B4%A3%E4%BB%BB%E9%93%BE">责任链</a></td><td>允许你将请求沿着处理者链进行发送。 收<br>到请求后， 每个处理者均可对请求进行处理， 或将<br>其传递给链上的下个处理者</td><td>当程序需要使用不同方式处理不同种<br>类请求， 而且请求类型和顺序预先未<br>知时， 可以使用责任链模式</td></tr><tr><td><a href="#%E8%AE%BF%E9%97%AE%E8%80%85">访问者</a></td><td>它能将算法与其所作用的对象隔离开来</td><td>数据结构与数据操作分离</td></tr><tr><td><a href="#%E7%8A%B6%E6%80%81">状态</a></td><td>允许一个对象在其内部状态改变时,改<br>变它的行为</td><td>如果对象需要根据自身当前状态进行不<br>同行为， 同时状态的数量非常多且与状<br>态相关的代码会频繁变更的话， 可使<br>用状态模式</td></tr></tbody></table><h3 id="创建型"><a class="markdownIt-Anchor" href="#创建型"></a> 创建型</h3><h4 id="简单工厂"><a class="markdownIt-Anchor" href="#简单工厂"></a> 简单工厂</h4><p><code>根据不同的参数创建不同的产品</code></p><p class="note note-primary">适用场景</p><ul><li><p>工厂类负责创建的对象比较少</p></li><li><p>客户端（应用层）只知道传入工厂类的参数对于如何创建对象（逻辑）不关心</p></li></ul><p class="note note-primary">优缺点</p><p><code>优点</code>：只需要传入一个正确的参数，就可以获取你所需要的对象而无须知道其创建细节</p><p><code>缺点</code>：工厂类的职责相对过重，增加新的产品需要修改工厂类的判断逻辑，违背开闭原则</p><p class="note note-primary">角色说明</p><ul><li><code>抽象产品</code>：定义了产品的规范，描述了产品的主要特性和功能</li><li><code>具体产品</code>：实现或继承了抽象产品的类</li><li><code>具体工厂</code>：提供了创建产品的方法，调用者通过该方法来创建产品</li></ul><p class="note note-primary">模拟场景</p><p>咖啡店出售美式咖啡和拿铁咖啡，模拟下单场景</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 抽象产品</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Coffee</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">drink</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 具体产品</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AmericanCoffee</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Coffee</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drink</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;喝美式咖啡&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 具体工厂</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CoffeeShop</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Coffee <span class="hljs-title function_">create</span><span class="hljs-params">(String type)</span> &#123;<br>        <span class="hljs-type">Coffee</span> <span class="hljs-variable">coffee</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">switch</span> (type) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;american&quot;</span>:<br>                coffee = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AmericanCoffee</span>();<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;latte&quot;</span>:<br>                coffee = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LatteCoffee</span>();<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> coffee;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Coffee</span> <span class="hljs-variable">american</span> <span class="hljs-operator">=</span> CoffeeShop.create(<span class="hljs-string">&quot;american&quot;</span>);<br>        american.drink();<br><br>        <span class="hljs-type">Coffee</span> <span class="hljs-variable">latte</span> <span class="hljs-operator">=</span> CoffeeShop.create(<span class="hljs-string">&quot;latte&quot;</span>);<br>        latte.drink();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p class="note note-primary">源码解析</p><p>Spring框架的<code>BeanFactory</code>就使用简单工厂模式提供Bean的获取</p><p><code>DefaultListableBeanFactory#getBean(Class)</code>源码，用户不必关心Bean的创建过程</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">getBean</span><span class="hljs-params">(Class&lt;T&gt; requiredType)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>	<span class="hljs-keyword">return</span> getBean(requiredType, (Object[]) <span class="hljs-literal">null</span>);<br>&#125;<br><br><span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">getBean</span><span class="hljs-params">(Class&lt;T&gt; requiredType, <span class="hljs-meta">@Nullable</span> Object... args)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>	Assert.notNull(requiredType, <span class="hljs-string">&quot;Required type must not be null&quot;</span>);<br>	<span class="hljs-type">Object</span> <span class="hljs-variable">resolved</span> <span class="hljs-operator">=</span> resolveBean(ResolvableType.forRawClass(requiredType), args, <span class="hljs-literal">false</span>);<br>	<span class="hljs-keyword">if</span> (resolved == <span class="hljs-literal">null</span>) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoSuchBeanDefinitionException</span>(requiredType);<br>	&#125;<br>	<span class="hljs-keyword">return</span> (T) resolved;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="工厂方法"><a class="markdownIt-Anchor" href="#工厂方法"></a> 工厂方法</h4><p><code>针对产品等级结构</code> <code>不同的工厂生产不同的产品</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><p>定义一个创建对象的接口，允许子类决定实例化对象的类型</p><hr><p><strong>适用场景</strong></p><ul><li>创建对象需要大量重复的代码</li><li>客户端(应用层)不依赖于产品类实例如何被创建、实现等细节</li><li>一个类通过其子类来指定创建哪个对象</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>用户只需要关心所需产品对应的工厂，无须关心创建细节</li><li>加入新产品符合开闭原则，提高可扩展性</li></ul><p>缺点</p><ul><li>类的个数容易过多，增加复杂度</li><li>增加了系统的抽象性和理解难度</li></ul><hr><p><strong>角色说明</strong></p><p><code>抽象产品</code>：将会对接口进行声明。 对于所有由创建者及其子类构建的对象， 这些接口都是通用的</p><p><code>具体产品</code>：是产品接口的不同实现</p><p><code>工厂方法</code>：定义返回产品对象的工厂方法</p><p><code>具体创建者</code>：将会重写基础工厂方法， 使其返回不同类型的产品</p><hr><p><strong>模拟场景</strong></p><p>夏天，冰箱供销商需要买进一系列冰箱，冰箱有美的，格力的品牌，不同的品牌又有各自的工厂</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 冰箱（抽象产品）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Fridge</span> &#123;<br>    <span class="hljs-keyword">abstract</span> String <span class="hljs-title function_">getBrand</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 格力冰箱（具体产品）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GreeFridge</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Fridge</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    String <span class="hljs-title function_">getBrand</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;格力冰箱&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 美的冰箱（具体产品）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MideaFirdge</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Fridge</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    String <span class="hljs-title function_">getBrand</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;美的冰箱&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 工厂方法</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Factory</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> Fridge <span class="hljs-title function_">create</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 格力工厂（具体创建者）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GreeFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Factory</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Fridge <span class="hljs-title function_">create</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GreeFridge</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 美的工厂（具体创建者）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MideaFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Factory</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Fridge <span class="hljs-title function_">create</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MideaFirdge</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Factory</span> <span class="hljs-variable">greeFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GreeFactory</span>();<br>        <span class="hljs-type">Factory</span> <span class="hljs-variable">mideaFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MideaFactory</span>();<br><br>        <span class="hljs-type">Fridge</span> <span class="hljs-variable">greeFridge</span> <span class="hljs-operator">=</span> greeFactory.create();<br>        <span class="hljs-type">Fridge</span>  <span class="hljs-variable">mideaFridge</span> <span class="hljs-operator">=</span> mideaFactory.create();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p>Spring框架的<code>FactoryBean</code>体系就用到了方法工厂模式，每个FactoryBean用户都可以自定义Bena的创建过程</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%96%B9%E6%B3%95%E5%B7%A5%E5%8E%82.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%952.png" srcset="/img/loading.gif" lazyload alt></p><h4 id="抽象工厂"><a class="markdownIt-Anchor" href="#抽象工厂"></a> 抽象工厂</h4><blockquote><p><code>针对产品族</code> <code>不同工厂生产不同品族的产品</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li>抽象工厂模式提供一个创建一系列相关或相互依赖对象的接口</li><li>无须指定它们具体的类</li></ul><hr><p><strong>适用场景</strong></p><ul><li>客户端(应用层)不依赖于产品类实例如何被创建、实现等细节</li><li>强调一系列相关的产品对象(属于同一产品族)一起使用创建对象需要大量重复的代码</li><li>提供一个产品类的库，所有的产品以同样的接口出现，从而使客户端不依赖于具体实现</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>具体产品在应用层代码隔离，无须关心创建细节</li><li>将一个系列的产品族统一到一起创建</li></ul><p>缺点</p><ul><li>规定了所有可能被创建的产品集合，产品族中扩展新的产品困难，需要修改抽象工厂的接口</li><li>增加了系统的抽象性和理解难度</li></ul><hr><p><strong>产品等级结构和产品族</strong></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BA%A7%E5%93%81%E7%AD%89%E7%BA%A7%E7%BB%93%E6%9E%84%E5%92%8C%E4%BA%A7%E5%93%81%E6%97%8F.png" srcset="/img/loading.gif" lazyload alt></p><p>上图表示<code>产品族</code>和<code>产品等级结构</code>的关系</p><ul><li><p><code>产品族</code>：具有同一个地区、同一个厂商、同一个开发包、同一个组织模块等，但是具备不同特点或功能的产品集合，称之为是一个产品族</p></li><li><p><code>产品等级结构</code>：具有相同特点或功能，但是来自不同的地区、不同的厂商、不同的开发包、不同的组织模块等的产品集合，称之为是一个产品等级结构</p></li></ul><p><span style="border-bottom:2px dashed green">当程序中的对象可以被划分为<code>产品族</code>和<code>产品等级结构</code>之后，那么<code>抽象工厂方法模式</code>才可以被适用</span></p><hr><p><strong>角色说明</strong></p><p><code>抽象产品</code>： 为构成系列产品的一组不同但相关的产品声明接口</p><p><code>具体产品</code>：抽象产品的多种不同类型实现</p><p><code>抽象工厂</code>：接口声明了一组创建各种抽象产品的方法</p><p><code>具体工厂</code>：现抽象工厂的构建方法。 每个具体工厂都对应特定产品变体， 且仅创建此种产品变体</p><hr><p><strong>模拟场景</strong></p><p>教育网有java、python课程，教程又分为视频和文章两部分</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 文章（抽象产品）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Article</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">produce</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * java 文章（具体产品）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaArticle</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Article</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">produce</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;编写java文章&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * python 文章（具体产品）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PythonArticle</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Article</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">produce</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;编写Python文章&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 视频（抽象产品）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Video</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">produce</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * java 视频（具体产品）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaVideo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Video</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">produce</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;录制Java视频&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * python 视频（具体产品）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PythonVideo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Video</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">produce</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;录制Python视频&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 课程抽象工厂（抽象工厂，声明一组创建抽象产品的方法）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CourseFactory</span> &#123;<br>    Video <span class="hljs-title function_">createVideo</span><span class="hljs-params">()</span>;<br>    Article <span class="hljs-title function_">createArticle</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * java工厂，创建java课程产品族</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaCourseFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CourseFactory</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Video <span class="hljs-title function_">createVideo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JavaVideo</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Article <span class="hljs-title function_">createArticle</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JavaArticle</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Python工厂，创建Python课程产品族</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PythonCourseFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CourseFactory</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Video <span class="hljs-title function_">createVideo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PythonVideo</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Article <span class="hljs-title function_">createArticle</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PythonArticle</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">CourseFactory</span> <span class="hljs-variable">courseFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JavaCourseFactory</span>();<br>        <span class="hljs-type">Video</span> <span class="hljs-variable">javaVideo</span> <span class="hljs-operator">=</span> courseFactory.createVideo();<br>        <span class="hljs-type">Article</span> <span class="hljs-variable">javaArticle</span> <span class="hljs-operator">=</span> courseFactory.createArticle();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p><strong>Mybatis</strong></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82mybatis1.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82mybatis2.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>Spring</strong></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82Spring1.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82Spring2.png" srcset="/img/loading.gif" lazyload alt></p></blockquote><h4 id="建造者"><a class="markdownIt-Anchor" href="#建造者"></a> 建造者</h4><blockquote><p><code>建造者模式更注重创建产品的步骤，工厂模式注重创建成品</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%BB%BA%E9%80%A0%E8%80%85%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li>将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示</li><li>用户只需指定需要建造的类型就可以得到它们，建造过程及细节不需要知道</li></ul><hr><p><strong>适用场景</strong></p><ul><li>如果一个对象有非常复杂的内部结构(很多属性)</li><li>想把复杂对象的创建和使用分离</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>封装性好，创建和使用分离</li><li>扩展性好、建造类之间独立、一定程度上解耦</li></ul><p>缺点</p><ul><li>产生多余的Builder对象</li><li>产品内部发生变化，建造者都要修改，成本较大</li></ul><hr><p><strong>角色说明</strong></p><p><code>产品</code>：是最终生成的对象。 由不同生成器构造的产品无需属于同一类层次结构或接口</p><p><code>生成器</code>：接口声明,在所有类型生成器中通用的产品构造步骤</p><p><code>具体生成器</code>：提供构造过程的不同实现。 具体生成器也可以构造不遵循通用接口的产品</p><p><code>主管（Director）</code>：定义调用构造步骤的顺序， 这样你就可以创建和复用特定的产品配置</p><hr><p><strong>使用</strong></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%BB%BA%E9%80%A0%E8%80%85.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 产品</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ToString</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-keyword">private</span> BigDecimal price;<br>    <span class="hljs-keyword">private</span> Integer stock;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 生成器</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span> &#123;<br>    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildProductId</span><span class="hljs-params">(Integer id)</span>;<br>    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildProductPrice</span><span class="hljs-params">(BigDecimal price)</span>;<br>    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildProductStock</span><span class="hljs-params">(Integer stock)</span>;<br><br>    <span class="hljs-keyword">abstract</span> Product <span class="hljs-title function_">makeProduct</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 具体生成器</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductBuilder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Builder</span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildProductId</span><span class="hljs-params">(Integer id)</span> &#123;<br>        product.setId(id);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildProductPrice</span><span class="hljs-params">(BigDecimal price)</span> &#123;<br>        product.setPrice(price);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildProductStock</span><span class="hljs-params">(Integer stock)</span> &#123;<br>        product.setStock(stock);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    Product <span class="hljs-title function_">makeProduct</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> product;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 主管类，定义调用构造步骤的顺序</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Director</span> &#123;<br>    <span class="hljs-keyword">private</span> Builder builder;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Director</span><span class="hljs-params">(Builder builder)</span> &#123;<br>        <span class="hljs-built_in">this</span>.builder = builder;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">makeProduct</span><span class="hljs-params">(Integer id, BigDecimal price, Integer stock)</span> &#123;<br>        <span class="hljs-built_in">this</span>.builder.buildProductId(id);<br>        <span class="hljs-built_in">this</span>.builder.buildProductPrice(price);<br>        <span class="hljs-built_in">this</span>.builder.buildProductStock(stock);<br>        <span class="hljs-keyword">return</span> builder.makeProduct();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Builder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductBuilder</span>();<br>        <span class="hljs-type">Director</span> <span class="hljs-variable">director</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Director</span>(builder);<br>        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> director.makeProduct(<span class="hljs-number">1</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">10</span>), <span class="hljs-number">10</span>);<br>        System.out.println(product);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>内部静态类模式（常用）</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ToString</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Product</span><span class="hljs-params">(Integer id, BigDecimal price, Integer stock)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>        <span class="hljs-built_in">this</span>.price = price;<br>        <span class="hljs-built_in">this</span>.stock = stock;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-keyword">private</span> BigDecimal price;<br>    <span class="hljs-keyword">private</span> Integer stock;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ProductBuilder <span class="hljs-title function_">builder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductBuilder</span>();<br>    &#125;<br><br>    <span class="hljs-comment">// 构建类</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductBuilder</span> &#123;<br>        <span class="hljs-keyword">private</span> Integer id;<br>        <span class="hljs-keyword">private</span> BigDecimal price;<br>        <span class="hljs-keyword">private</span> Integer stock;<br><br>        <span class="hljs-comment">// 链式调用</span><br>        <span class="hljs-keyword">public</span> Product.ProductBuilder <span class="hljs-title function_">id</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Integer id)</span> &#123;<br>            <span class="hljs-built_in">this</span>.id = id;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> Product.ProductBuilder <span class="hljs-title function_">price</span><span class="hljs-params">(<span class="hljs-keyword">final</span> BigDecimal price)</span> &#123;<br>            <span class="hljs-built_in">this</span>.price = price;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> Product.ProductBuilder <span class="hljs-title function_">stock</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Integer stock)</span> &#123;<br>            <span class="hljs-built_in">this</span>.stock = stock;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 通过构造函数创建对象</span><br>        <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">build</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(<span class="hljs-built_in">this</span>.id, <span class="hljs-built_in">this</span>.price, <span class="hljs-built_in">this</span>.stock);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> Product.builder()<br>                .id(<span class="hljs-number">1</span>)<br>                .price(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">10</span>))<br>                .stock(<span class="hljs-number">10</span>)<br>                .build();<br>        System.out.println(product);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p><strong>JDK</strong></p><ul><li><code>StringBuilder</code></li><li><code>StringBuffer</code></li></ul><p>底层都是byte[]，使用构建者模式简化字符串拼接</p><p><strong>Mybatis</strong></p><ul><li><code>SqlSessionFactoryBuilder</code>：使用<code>mybatis.xml</code>配置文件通过SqlSessionFactoryBuilder 建造 SqlSessionFactory</li><li><code>XMLConfigBuilder</code></li><li><code>XMLMapperBuilder</code></li><li><code>XMLStatementBuilder</code></li><li><code>CacheBuilder</code></li></ul><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%9E%84%E9%80%A0%E8%80%85mybatis1.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%9E%84%E9%80%A0%E8%80%85mybatis2.png" srcset="/img/loading.gif" lazyload alt></p><br><p><strong>Spring</strong></p><p><code>BeanDefinitionBuilder</code>用于构造<code>BeanDefinition</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%9E%84%E9%80%A0%E8%80%85Spring.png" srcset="/img/loading.gif" lazyload alt></p></blockquote><h4 id="原型"><a class="markdownIt-Anchor" href="#原型"></a> 原型</h4><blockquote><p><code>细胞分裂</code> <code>依赖对象的克隆复制新的对象</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8E%9F%E5%9E%8B%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li>指原型实例指定创建对象的种类，并且通过拷贝这些原型创建新的对象</li><li>不需要知道任何创建的细节，不调用构造函数</li></ul><hr><p><strong>适用场景</strong></p><ul><li>类初始化消耗较多资源</li><li>new产生的一个对象需要非常繁琐的过程(数据准备、访问权限等)</li><li>构造函数比较复杂</li><li>循环体中生产大量对象时</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>原型模式性能比直接new一个对象性能高</li><li>简化创建过程</li></ul><p>缺点</p><ul><li>必须配备克隆方法</li><li>对克隆复杂对象或对克隆出的对象进行复杂改造时，容易引入风险</li><li><span style="border-bottom:2px dashed green">深拷贝、浅拷贝要运用得当</span></li></ul><hr><p><strong>深克隆、浅克隆</strong></p><p>参考 <a href="/2022/04/13/java%E6%BA%90%E7%A0%81/#%E6%B5%85%E6%8B%B7%E8%B4%9D%E5%92%8C%E6%B7%B1%E6%8B%B7%E8%B4%9D">深拷贝和浅拷贝</a></p><p>深拷贝还可以通过序列化的方式来实现</p><hr><p><strong>角色说明</strong></p><p><code>原型</code>：接口将对克隆方法进行声明，JDK提供的<code>Cloneable</code>接口是个不错的选择</p><p><code>具体原型</code>：实现克隆方法。 除了将原始对象的数据复制到克隆体中之外， 该方法有时还需处理克隆过程中的极端情况， 例如克隆关联对象和梳理递归依赖等等</p><p><code>客户端</code>：可以复制实现了原型接口的任何对象</p><hr><p><strong>模拟场景</strong></p><p>批量发送营销邮件，邮件除了邮件地址其他内容都一样</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8E%9F%E5%9E%8BUML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 具体原型</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ToString</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Mail</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cloneable</span>&#123;<br>    <span class="hljs-keyword">private</span> String emailAddress;<br>    <span class="hljs-keyword">private</span> String content;<br><br>    <span class="hljs-comment">// 实现克隆方法</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.clone();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br>        <span class="hljs-comment">// 创建原型</span><br>        <span class="hljs-type">Mail</span> <span class="hljs-variable">prototype</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mail</span>();<br>        prototype.setContent(<span class="hljs-string">&quot;双十一大促销！&quot;</span>);<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            <span class="hljs-comment">// 根据原型克隆</span><br>            <span class="hljs-type">Mail</span> <span class="hljs-variable">mail</span> <span class="hljs-operator">=</span> (Mail) prototype.clone();<br>            mail.setEmailAddress(i + <span class="hljs-string">&quot;@test.com&quot;</span>);<br>            send(mail);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">send</span><span class="hljs-params">(Mail mail)</span> &#123;<br>        System.out.println(mail);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></blockquote><h4 id="单例"><a class="markdownIt-Anchor" href="#单例"></a> 单例</h4><blockquote><p><code>系统中只存在一个实例</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><p>能够保证一个类只有一个实例， 并提供一个访问该实例的全局入口</p><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>单例模式可以保证内存里只有一个实例，减少了内存的开销</li><li>为共享资源提供一个全局统一的访问点</li></ul><p>缺点</p><ul><li>单例模式一般没有实现接口，扩展困难</li><li>单例模式如果业务过重，则很容易违背<code>单一责职原则</code></li></ul><hr><p><strong>适用场景</strong></p><ul><li><p>如果程序中的某个类对于所有客户端只有一个可用的实例，可以使用单例模式</p></li><li><p>如果你需要更加严格地控制全局变量，可以使用单例模式</p></li><li><p>数据库连接池的设计一般采用单例模式</p></li></ul></blockquote><h5 id="容器单例"><a class="markdownIt-Anchor" href="#容器单例"></a> 容器单例</h5><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ContainerSingleton</span> &#123;<br><br>    <span class="hljs-comment">// 防止实例化</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">ContainerSingleton</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-comment">// 单例容器</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, Object&gt; singletonMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将实例放入容器</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> instance</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setInstance</span><span class="hljs-params">(String key, Object instance)</span> &#123;<br>        <span class="hljs-keyword">if</span> (Objects.isNull(key)) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;key is null&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (Objects.isNull(instance)) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;instance is null&quot;</span>);<br>        &#125;<br><br>        singletonMap.computeIfAbsent(key, k -&gt; instance);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">getInstance</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-keyword">if</span> (Objects.isNull(key)) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;key is null&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> singletonMap.get(key);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        ContainerSingleton.setInstance(<span class="hljs-string">&quot;one&quot;</span>, <span class="hljs-number">1</span>);<br>        ContainerSingleton.setInstance(<span class="hljs-string">&quot;two&quot;</span>, <span class="hljs-number">2</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><span style="border-bottom:2px dashed green">容器单例模式不负责对象的创建过程，而是将已有对象存入容器重复使用，让容器保证实例的单例性，常用于缓存</span></p></blockquote><h5 id="懒汉式"><a class="markdownIt-Anchor" href="#懒汉式"></a> 懒汉式</h5><blockquote><p><code>非线程安全</code> <code>懒加载思想</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br> <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Singleton singleton;<br><br> <span class="hljs-comment">// 避免被实例化</span><br> <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123;<br> &#125;<br><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getSingleton</span><span class="hljs-params">()</span> &#123;<br>     <span class="hljs-comment">// 比较懒，用到才判断</span><br>     <span class="hljs-keyword">if</span> (singleton == <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-comment">// 并发情况下有线程安全问题</span><br>         singleton = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>     &#125;<br>     <span class="hljs-keyword">return</span> singleton;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><span style="border-bottom:2px dashed green">懒汉式最大的缺点就是面对多线程获取单例的时候，无法保证线程安全，可能会创建多个实例</span></p></blockquote><h5 id="饿汉式"><a class="markdownIt-Anchor" href="#饿汉式"></a> 饿汉式</h5><blockquote><p><code>线程安全</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br> <span class="hljs-comment">// 避免被实例化</span><br> <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123;<br> &#125;<br><br> <span class="hljs-comment">// 非常饥饿，一上来就实例化</span><br> <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>     <span class="hljs-keyword">return</span> instance;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>饿汉式是线程安全的，依赖于JVM类加载时机创建对象。缺点在于无法实现懒加载，造成资源浪费</p></blockquote><h5 id="双重检查"><a class="markdownIt-Anchor" href="#双重检查"></a> 双重检查</h5><blockquote><p><code>volative修饰保证线程可见性</code> <code>synchronized双重检查</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br> <span class="hljs-comment">// 避免被实例化</span><br> <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123;<br> &#125;<br><br> <span class="hljs-comment">// 保证多线程可见性</span><br> <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Singleton instance;<br> <br> <span class="hljs-keyword">public</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>     <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-keyword">synchronized</span> (Singleton.class) &#123;<br>             <span class="hljs-comment">// 存在并发线程安全</span><br>             <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>                 instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>             &#125;<br>         &#125;<br>     &#125;<br>     <br>     <span class="hljs-keyword">return</span> instance;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>双重检查解决并发获取实例时线程安全问题</p></blockquote><h5 id="枚举推荐"><a class="markdownIt-Anchor" href="#枚举推荐"></a> 枚举(推荐)</h5><blockquote><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000024575275">破坏单例模式</a></p><ul><li>内部枚举方式可以防止使用反射和序列化破坏单例模式</li><li>依赖JVM对枚举实例创建的线程安全性创建单例</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Singleton</span> &#123;<br>    INSTANCE;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomething</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;doSomething&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        Singleton.INSTANCE.doSomething();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></blockquote><h3 id="结构型"><a class="markdownIt-Anchor" href="#结构型"></a> 结构型</h3><h4 id="外观门面"><a class="markdownIt-Anchor" href="#外观门面"></a> 外观（门面）</h4><blockquote><p><code>微服务就是使用外观模式，向外提供简单的Api调用</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li>又叫门面模式，提供了一个统一的接口，用来访问子系统中的一群接口</li><li>外观模式定义了一个高层接口，让子系统更容易使用</li></ul><hr><p><strong>适用场景</strong></p><ul><li>子系统越来越复杂，增加外观模式提供简单调用接口</li><li>构建多层系统结构，利用外观对象作为每层的入口，简化层间调用</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>简化了调用过程，无需了解深入子系统，防止带来风险</li><li>减少系统依赖、松散耦合</li><li>更好的划分访问层次</li><li>符合迪米特法则，即最少知道原则</li></ul><p>缺点</p><ul><li>增加子系统、扩展子系统行为容易引入风险</li><li>不符合开闭原则</li></ul><hr><p><strong>与其他设计模式对比</strong></p><p><code>外观模式和中介者</code></p><ul><li>外观模式关注的是外界和子系统的交互</li><li><a href="#%E4%B8%AD%E4%BB%8B%E8%80%85">中介者模式</a>关注的是子系统内部的交互</li></ul><p><code>外观模式和单例模式</code></p><ul><li>通常把外观模式的外观对象做成<a href="#%E5%8D%95%E4%BE%8B">单例模式</a>来使用</li></ul><p><code>外观模式和抽象工厂模式</code></p><ul><li>外观类可以通过<a href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82">抽象工厂</a>获取子系统实例，子系统可以将内部对外观类屏蔽</li></ul><hr><p><strong>模拟场景</strong></p><p>分布式系统中的下单场景，系统分库存服务，订单服务，物流服务</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%A4%96%E8%A7%82UML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 订单外观类，调用分布式分服务</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderFacade</span> &#123;<br>    <span class="hljs-comment">// 正常情况是注入，都是远程RPC服务</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">StockService</span> <span class="hljs-variable">stockService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StockService</span>();<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">OrderService</span> <span class="hljs-variable">orderService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>();<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">LogisticsService</span> <span class="hljs-variable">logisticsService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogisticsService</span>();<br><br>    <span class="hljs-comment">// 下单, 对外屏蔽子系统</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">create</span><span class="hljs-params">(OrderParam orderParam)</span> &#123;<br>        <span class="hljs-comment">// 库存扣减</span><br>        stockService.deduction(orderParam);<br>        <span class="hljs-comment">// 生成订单</span><br>        orderService.create(orderParam);<br>        <span class="hljs-comment">// 生成物流单</span><br>        logisticsService.create(orderParam);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 库存服务</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StockService</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deduction</span><span class="hljs-params">(OrderParam param)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;库存扣减&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 订单服务</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">create</span><span class="hljs-params">(OrderParam param)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;生成订单&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 物流服务</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogisticsService</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">create</span><span class="hljs-params">(OrderParam param)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;生成物流单号&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">OrderParam</span> <span class="hljs-variable">param</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderParam</span>();<br>        param.setNum(<span class="hljs-number">1</span>);<br>        param.setSku(<span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-comment">// 外观类</span><br>        <span class="hljs-type">OrderFacade</span> <span class="hljs-variable">facade</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderFacade</span>();<br>        facade.create(param);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p><strong>Mybatis</strong></p><p>Mybatis通过外观设计模式封装了<code>SqlSession</code>会话层，对外屏蔽了<code>Executor</code>调用的复杂性</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8FMybatis1.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8FMybatis2.png" srcset="/img/loading.gif" lazyload alt></p><br><p><strong>Spring JDBC</strong></p><p>Spring JDBC的<code>JdbcUtils</code>通过对<code>原生的 jdbc 进行了封装</code>降低原生jdbc使用的复杂性</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8FSpring1.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8FSpring2.png" srcset="/img/loading.gif" lazyload alt></p></blockquote><h4 id="装饰者"><a class="markdownIt-Anchor" href="#装饰者"></a> 装饰者</h4><blockquote><p><code>不改变原有对象扩展对象功能</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li>在不改变原有对象的基础之上，将功能附加到对象上</li><li>提供了比继承更有弹性的替代方案(扩展原有对象功能)</li></ul><hr><p><strong>适用场景</strong></p><ul><li>扩展一个类的功能或给一个类添加附加职责</li><li>动态的给一个对象添加功能，这些功能可以再动态的撤销</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>继承的有力补充，比继承灵活，不改变原有对象的情况下给一个对象扩展功能</li><li>通过使用不同装饰类以及这些装饰类的排列组合，可以实现不同效果</li><li>符合开闭原则</li></ul><p>缺点</p><ul><li>会出现更多的代码，更多的类，增加程序复杂性</li><li>动态装饰时，多层装饰时会更复杂</li></ul><hr><p><strong>角色说明</strong></p><ul><li><code>抽象构件</code>：它是具体构件和抽象装饰类的共同父类，声明了要在具体构件中实现的业务方法，它的引入可以使客户端以一致的方式处理未被装饰的对象以及装饰之后的对象。抽象构件一般定义为<strong>接口</strong></li><li><code>具体构件</code>：它是抽象构件类的子类，用于定义具体的构件对象，实现了在抽象构件中声明的方法，装饰对象可以给它增加额外的职责（方法）</li><li><code>抽象装饰类</code>：它也是抽象构件类的子类，用于给具体构件增加职责，但是具体职责在其子类中实现。它维护一个指向抽象构件对象的引用，通过该引用可以调用装饰之前构件对象的方法，并通过其子类扩展该方法，以达到装饰的目的</li><li><code>具体装饰类</code>：它是抽象装饰类的子类，负责向构件添加新的职责。每一个具体装饰类都定义了一些新的行为，它可以调用在抽象装饰类中定义的方法，并可以增加新的方法用以扩充对象的行为</li></ul><hr><p><strong>与其他设计模式对比</strong></p><p><code>装饰者模式和代理模式</code></p><p>相同点</p><ul><li>两种从设计模式分类来看都属于结构型，因为两者均使用了组合关系。其次两者都能实现对对象方法进行增强处理的效果</li></ul><p>不同点</p><ul><li>装饰者模式：注重的是对对象提供增强功能</li><li><a href="#%E4%BB%A3%E7%90%86">代理模式</a>：对所代理对象的使用施加控制，并不提供对象本身的增强功能</li></ul><p><code>装饰者模式和适配器模式</code></p><p>相同点</p><ul><li>装饰器与适配器都有一个别名叫做 包装模式(Wrapper)，它们看似都是起到包装一个类或对象的作用</li></ul><p>不同点</p><ul><li><a href="#%E9%80%82%E9%85%8D%E5%99%A8">适配器模式</a>：是要将一个接口转变成另一个接口，它的目的是通过改变接口来达到重复使用的目的</li><li>装饰器模式：不是要改变被装饰对象的接口，而是恰恰要保持原有的接口，但是增强原有对象的功能</li></ul><hr><p><strong>模拟场景</strong></p><p>奶茶店出售的奶茶可以是基本的珍珠奶茶，用户也可以选择自定义添加底料，比如加奶盖，焦糖</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8FUML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 定义奶茶（抽象构件）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractMilkTea</span> &#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> String <span class="hljs-title function_">getDesc</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 奶茶（具体构件）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MilkTea</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMilkTea</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> String <span class="hljs-title function_">getDesc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;珍珠奶茶&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">8</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 抽象装饰类继承抽象构件</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractDecorator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMilkTea</span> &#123;<br>    <span class="hljs-comment">// 抽象装饰类持有构件</span><br>    <span class="hljs-keyword">protected</span> AbstractMilkTea milkTea;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AbstractDecorator</span><span class="hljs-params">(AbstractMilkTea milkTea)</span> &#123;<br>        <span class="hljs-built_in">this</span>.milkTea = milkTea;<br>    &#125;<br><br>    <span class="hljs-comment">// 装饰类扩展的方法，是否赠送礼品</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">sendGifts</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/** </span><br><span class="hljs-comment"> * 加焦糖</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CaramelDecorator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractDecorator</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CaramelDecorator</span><span class="hljs-params">(AbstractMilkTea milkTea)</span> &#123;<br>        <span class="hljs-built_in">super</span>(milkTea);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">sendGifts</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 对原有对象进行增强</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> String <span class="hljs-title function_">getDesc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> milkTea.getDesc() + <span class="hljs-string">&quot;加焦糖&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> milkTea.getPrice() + <span class="hljs-number">2</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/** </span><br><span class="hljs-comment"> * 加奶盖</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MilkCapDecorator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractDecorator</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MilkCapDecorator</span><span class="hljs-params">(AbstractMilkTea milkTea)</span> &#123;<br>        <span class="hljs-built_in">super</span>(milkTea);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">sendGifts</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> String <span class="hljs-title function_">getDesc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> milkTea.getDesc() + <span class="hljs-string">&quot;加奶盖&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> milkTea.getPrice() + <span class="hljs-number">5</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 珍珠奶茶</span><br>        <span class="hljs-type">AbstractMilkTea</span> <span class="hljs-variable">abstractMilkTea</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MilkTea</span>();<br>        <br>        <span class="hljs-comment">// 加焦糖</span><br>        abstractMilkTea = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaramelDecorator</span>(abstractMilkTea);<br>        System.out.println(abstractMilkTea.getDesc());<br>        System.out.println(abstractMilkTea.getPrice());<br><br>        <span class="hljs-comment">// 加奶盖</span><br>        abstractMilkTea = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MilkCapDecorator</span>(abstractMilkTea);<br>        System.out.println(abstractMilkTea.getDesc());<br>        System.out.println(abstractMilkTea.getPrice());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p><strong>jdk的缓冲流体系</strong></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8FJDK.png" srcset="/img/loading.gif" lazyload alt></p><p>*Buffered* 的缓冲流都是对输入输出流进行包装达增强，达到快速读写目的</p><p><strong>Spring</strong></p><p>Spring 在<code>Cache</code>体系中使用了装饰者模式对缓存进行事务感知。简单的、事务感知的缓存装饰器，它在提交之前暂时保存缓存值，以避免在回滚时用无效值污染缓存</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8FSrping1.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8FSpring2.png" srcset="/img/loading.gif" lazyload alt></p></blockquote><h4 id="适配器"><a class="markdownIt-Anchor" href="#适配器"></a> 适配器</h4><blockquote><p><code>电源适配器，通过电压转换后各种设备可以正常使用</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li>将一个类的接口转换成客户期望的另一个接口</li><li>使原本接口不兼容的类可以一起工作</li></ul><hr><p><strong>适用场景</strong></p><ul><li>已经存在的类，它的方法和需求不匹配时（方法结果相同或相似，对不匹配的类进行复用）</li><li>不是软件设计阶段考虑的设计模式，是随着软件维护，由于不同产品、不同厂家造成功能类似而接口不相同情况下的解决方案</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>能提高类的透明性和复用，现有的类复用但不需要改变</li><li>目标类和适配器类解耦，提高程序扩展性</li></ul><p>缺点</p><ul><li>适配器编写过程需要全面考虑，可能会增加系统的复杂性</li><li>增加系统代码可读的难度</li></ul><hr><p><strong>与其他设计模式对比</strong></p><p><code>适配器和外观模式</code></p><ul><li><p>相同点：都是对现有的类进行封装</p></li><li><p><a href="#%E5%A4%96%E8%A7%82%EF%BC%88%E9%97%A8%E9%9D%A2%EF%BC%89">外观模式</a>：定义了新的统一接口封装了子系统的一群接口</p></li><li><p>适配器模式：主要是复用一个原有的接口，使已有的两个接口适配工作</p></li></ul><hr><p><strong>模拟场景 （对象适配）</strong></p><p>中国的电压是220V的，美国的电压是110V的，使用一个电源适配器让美国的家电能在中国使用</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E9%80%82%E9%85%8D%E5%99%A8UML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 中国电压标准</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ChinaVoltageStandard</span> &#123;<br>    <span class="hljs-comment">// 定义输出220V</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">output220V</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 中国电压</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChinaVoltage</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ChinaVoltageStandard</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">output220V</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;中国电压输出220V&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">220</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 美国电压标准</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UsVoltageStandard</span> &#123;<br><br>    <span class="hljs-comment">// 定义输出110V</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">output110V</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 美国电压适配器遵循美国电压标准</span><br><span class="hljs-comment"> * 将220V的电转为110V的电</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UsVoltageAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UsVoltageStandard</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">ChinaVoltage</span> <span class="hljs-variable">chinaVoltage</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChinaVoltage</span>();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">output110V</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;电压适配器转换电压&quot;</span>);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">voltage</span> <span class="hljs-operator">=</span> chinaVoltage.output220V() / <span class="hljs-number">2</span>;<br>        <span class="hljs-keyword">return</span> voltage;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">UsVoltageStandard</span> <span class="hljs-variable">usVoltage</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsVoltageAdapter</span>();<br>        System.out.println(<span class="hljs-string">&quot;输出电压：&quot;</span> + usVoltage.output110V());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>类适配</strong></p><p><code>适配器继承被适配类实和现适配接口</code></p><p>场景：服务重构，老订单服务适配新订单服务接口</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%B1%BB%E9%80%82%E9%85%8D%E5%99%A8.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderService</span> &#123;<br>    <span class="hljs-comment">// 下单支付</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">pay</span><span class="hljs-params">(String orderNo, Integer total)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderService</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">pay</span><span class="hljs-params">(String orderNo, Integer total)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;OrderService 下单扣款金额&quot;</span> + total);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderServiceV2</span> &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">pay</span><span class="hljs-params">(String orderNo, Integer total, Integer discount)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceV2Impl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderServiceV2</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">pay</span><span class="hljs-params">(String orderNo, Integer total, Integer discount)</span> &#123;<br>        total = total - discount;<br>        System.out.println(<span class="hljs-string">&quot;OrderServiceV2 下单扣款金额&quot;</span> + total);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceV2Adapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderServiceV2</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">pay</span><span class="hljs-params">(String orderNo, Integer total, Integer discount)</span> &#123;<br>        <span class="hljs-comment">// 适配逻辑</span><br>        total = total - discount;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.pay(orderNo, total);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">OrderServiceV2</span> <span class="hljs-variable">orderService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderServiceV2Adapter</span>();<br>        orderService.pay(<span class="hljs-string">&quot;t123&quot;</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p>Spring <code>AOP</code>将<code>Advisor</code>适配为<code>MethodInterceptor</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/SpringAdapter.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/SpringAopApadper.png" srcset="/img/loading.gif" lazyload alt></p><br><p>Spring MVC的<code>HandlerAdapter</code>，spring定义了一个适配器接口，使得每一种Controller有一种对应的适配器实现类。Controller种类很多，有需要视图渲染的，参数解析、封装的，有直接返回Json、Xml数据的。</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/SpringMvc%E9%80%82%E9%85%8D%E5%99%A81.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/SpringMvc%E9%80%82%E9%85%8D%E5%99%A82.png" srcset="/img/loading.gif" lazyload alt></p></blockquote><h4 id="享元"><a class="markdownIt-Anchor" href="#享元"></a> 享元</h4><blockquote><p><code>共享</code> <code>常用于缓存框架</code> <code>减少对象的创建，减少内存的占用</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li>提供了减少对象数量从而改善应用所需的对象结构的方式</li><li>通过共享多个对象所共有的相同状态， 在有限的内存容量中载入更多对象</li></ul><hr><p><strong>适用场景</strong></p><p><code>字符串常量池</code> <code>数据库连接池</code></p><ul><li>常常应用于系统底层的开发，以便解决系统的性能问题</li><li>系统有大量相似对象、需要缓冲池的场景</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>减少对象的创建，降低内存中对象的数量，降低系统的内存，提高效率</li><li>减少内存之外的其他资源占用（比如new对象占用的创建时间，文件句柄，窗口句柄）</li></ul><p>缺点</p><ul><li>关注内/外部状态、关注线程安全问题</li><li>使系统、程序的逻辑复杂化</li></ul><hr><p><strong>扩展</strong></p><ul><li><code>内部状态</code>：内部状态是存储在享元对象内部并且不会随环境变化而变化的状态，因此内部状态可以共享</li><li><code>外部状态</code>：外部状态是随环境改变而改变的、不可以共享的状态。享元对象的外部状态必须由客户端保存，并在享元对象被创建之后，在需要使用的时候再传入到享元对象内部。外部状态之间是相互独立的</li></ul><hr><p><strong>与其他设计模式对比</strong></p><p><code>享元模式和代理模式</code></p><ul><li><a href="#%E4%BB%A3%E7%90%86">代理模式</a>需要代理一个类，如果生成这个代理类需要花费的时间和资源非常多，则可以使用享元模式提高程序的处理速度</li></ul><p><code>享元模式和单例模式</code></p><ul><li>根据不同的业务场景使用，比如缓存级别的对象复用，则使用享元模式。如果是工具级别的对象并且其创建过程很耗费资源则使用<a href="#%E5%8D%95%E4%BE%8B">单例模式</a></li></ul><hr><p><strong>模拟场景</strong></p><p><code>享元工厂</code></p><p>在一个数据库会话中实现一个数据库查询缓存插件，将查询结构存入缓存，不需要每次都去数据库中查询</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8FUML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 缓存接口</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Cache</span> &#123;<br><br>    <span class="hljs-comment">// 获取缓存数据</span><br>    Object <span class="hljs-title function_">getData</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 缓存实现</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleCache</span><span class="hljs-params">(Object data)</span> &#123;<br>        <span class="hljs-built_in">this</span>.data = data;<br>    &#125;<br><br>    <span class="hljs-comment">//缓存时间，内部状态，不会随着外部环境改变，可用于控制缓存失效</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Date</span> <span class="hljs-variable">cacheTime</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br><br>    <span class="hljs-comment">// 外部状态</span><br>    <span class="hljs-keyword">private</span> Object data;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getData</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> data;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;SimpleCache&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;cacheTime=&quot;</span> + cacheTime +<br>                <span class="hljs-string">&quot;, data=&quot;</span> + data +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 缓存工厂</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheFactory</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> Map&lt;String, Cache&gt; CACHE_CONTAINER = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Cache <span class="hljs-title function_">getCache</span><span class="hljs-params">(String sql)</span> &#123;<br>        <span class="hljs-comment">// 模拟缓存没有则从数据库中查询</span><br>        <span class="hljs-type">Cache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> CACHE_CONTAINER.computeIfAbsent(sql, (key) -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleCache</span>((<span class="hljs-type">int</span>)(Math.random() * <span class="hljs-number">100</span>)));<br>        <span class="hljs-keyword">return</span> cache;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">no</span> <span class="hljs-operator">=</span>  (<span class="hljs-type">int</span>)(Math.random() * <span class="hljs-number">2</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;select id from user where no=&quot;</span> + no;<br>            <span class="hljs-type">Cache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> CacheFactory.getCache(sql);<br>            System.out.println(sql + <span class="hljs-string">&quot; -&gt; &quot;</span> + cache);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p><strong>JDK</strong></p><p>Java源码中的Integer存在缓存池，如果取值在<code>[-128,127]</code>，则取缓存池中的对象</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Integer.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>Mybatis</strong></p><p>Mybatis的<code>Configuration</code>类缓存了<code>MappedStatement</code>、<code>ResultMap</code>、<code>ParameterMap</code>等信息</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8FMybatis.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8FMybatis2.png" srcset="/img/loading.gif" lazyload alt></p></blockquote><h4 id="组合"><a class="markdownIt-Anchor" href="#组合"></a> 组合</h4><blockquote><p><code>目录</code> <code>菜单</code> <code>将多种类型的对象按照一致的方式处理</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li>将对象组合成树形结构以表示<code>部分-整体</code>的层次结构</li><li>组合模式使客户端对单个对象和组合对象保持一致的方式处理</li></ul><hr><p><strong>适用场景</strong></p><ul><li>希望客户端可以忽略组合对象与单个对象的差异时</li><li>如果你需要实现树状对象结构， 可以使用组合模式</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>清楚地定义分层次的复杂对象，表示对象的全部或部分层次</li><li>让客户端忽略了层次的差异，方便对整个层次结构进行控制</li><li>简化客户端代码</li></ul><p>缺点</p><ul><li>限制类型时会较为复杂（多个不同的对象不一定都满足基类的方法）</li><li>使设计变得更加抽象</li></ul><hr><p><strong>角色说明</strong></p><ul><li><code>组件接口</code>：描述了树中简单项目和复杂项目所共有的操作</li><li><code>叶节点</code>：是树的基本结构， 它不包含子项目</li><li><code>容器</code>：又名 <code>组合 （Composite）</code>是包含叶节点或其他容器等子项目的单位。 容器不知道其子项目所属的具体类， 它只通过通用的组件接口与其子项目交互</li></ul><hr><p><strong>与其他设计模式对比</strong></p><p><code>组合模式和访问者模式</code></p><p>可以使用<a href="#%E8%AE%BF%E9%97%AE%E8%80%85">访问者模式</a>来访问组合模式的递归结构</p><hr><p><strong>模拟场景</strong></p><p>模拟系统菜单，菜单分为菜单目录和菜单项，菜单目录有名称并且能够添加菜单项，菜单项不能继续添加菜单项但有菜单名称和跳转Url，构建一个目录树，打印出所有的菜单目录和菜单项</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8FUML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 菜单类（组件）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Menu</span> &#123;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(<span class="hljs-string">&quot;不支持获取名称&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUrl</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(<span class="hljs-string">&quot;不支持获取url&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getLevel</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(<span class="hljs-string">&quot;不支持获取level&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(Menu menu)</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(<span class="hljs-string">&quot;不支持添加操作&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(Menu menu)</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(<span class="hljs-string">&quot;不支持删除操作&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(<span class="hljs-string">&quot;不支持删除操作&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 菜单目录（容器）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MenuCatalog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Menu</span> &#123;<br>    <span class="hljs-comment">// 目录下的菜单项</span><br>    <span class="hljs-keyword">private</span> List&lt;Menu&gt; items = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> level;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MenuCatalog</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> level)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.level = level;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.name;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getLevel</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> level;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(Menu menu)</span> &#123;<br>        <span class="hljs-built_in">this</span>.items.add(menu);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(Menu menu)</span> &#123;<br>        <span class="hljs-built_in">this</span>.items.remove(menu);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-built_in">this</span>.name);<br><br>        <span class="hljs-keyword">for</span> (Menu item : items) &#123;<br>            <span class="hljs-comment">// 类型限制，组合模式的坑点，打印缩进</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; item.getLevel(); i++) &#123;<br>                System.out.print(<span class="hljs-string">&quot; &quot;</span>);<br>            &#125;<br>            item.print();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 菜单项（叶节点）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MenuItem</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Menu</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String url;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> level;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MenuItem</span><span class="hljs-params">(String name, String url, <span class="hljs-type">int</span> level)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.url = url;<br>        <span class="hljs-built_in">this</span>.level = level;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUrl</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> url;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getLevel</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> level;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;name：&quot;</span> + name + <span class="hljs-string">&quot; url：&quot;</span> + url);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Menu</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MenuCatalog</span>(<span class="hljs-string">&quot;主目录&quot;</span>, <span class="hljs-number">1</span>);<br>        <span class="hljs-type">Menu</span> <span class="hljs-variable">search</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MenuCatalog</span>(<span class="hljs-string">&quot;搜索类&quot;</span>, <span class="hljs-number">2</span>);<br>        <span class="hljs-type">Menu</span> <span class="hljs-variable">video</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MenuCatalog</span>(<span class="hljs-string">&quot;视频类&quot;</span>, <span class="hljs-number">2</span>);<br>        root.add(search);<br>        root.add(video);<br><br>        <span class="hljs-type">Menu</span> <span class="hljs-variable">google</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MenuItem</span>(<span class="hljs-string">&quot;谷歌&quot;</span>, <span class="hljs-string">&quot;https://google.com&quot;</span>, <span class="hljs-number">3</span>);<br>        <span class="hljs-type">Menu</span> <span class="hljs-variable">baidu</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MenuItem</span>(<span class="hljs-string">&quot;百度&quot;</span>, <span class="hljs-string">&quot;https://www.baidu.com&quot;</span>, <span class="hljs-number">3</span>);<br>        search.add(google);<br>        search.add(baidu);<br><br>        <span class="hljs-type">Menu</span> <span class="hljs-variable">bilibili</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MenuItem</span>(<span class="hljs-string">&quot;B站&quot;</span>, <span class="hljs-string">&quot;https://www.bilibili.com&quot;</span>, <span class="hljs-number">3</span>);<br>        <span class="hljs-type">Menu</span> <span class="hljs-variable">youku</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MenuItem</span>(<span class="hljs-string">&quot;B站&quot;</span>, <span class="hljs-string">&quot;https://youku.com&quot;</span>, <span class="hljs-number">3</span>);<br>        video.add(bilibili);<br>        video.add(youku);<br><br>        root.print();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 输出</span><br>主目录<br>  搜索类<br>   name：谷歌 url：https:<span class="hljs-comment">//google.com</span><br>   name：百度 url：https:<span class="hljs-comment">//www.baidu.com</span><br>  视频类<br>   name：B站 url：https:<span class="hljs-comment">//www.bilibili.com</span><br>   name：B站 url：https:<span class="hljs-comment">//youku.com</span><br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p><strong>JDK</strong></p><p>JDK源码的<code>ArrayList#addAll</code>方法的入参类型不是<code>List</code>，而是它的父类<code>Collection</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8FArrayList.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>Spring</strong></p><p>Spring缓存模块的<code>CompositeCacheManager</code>复合缓存管理器可以管理不同中间件的缓存。如<code>CaffeineCacheManager</code>,<code>RedisCacheManager</code>等</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8FSpring.png" srcset="/img/loading.gif" lazyload alt></p></blockquote><h4 id="桥接"><a class="markdownIt-Anchor" href="#桥接"></a> 桥接</h4><blockquote><p><code>抽象和实现分离</code> <code>避免子类爆炸</code> <code>通过组合连接两个继承体系</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE0.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li>将抽象部分与它的具体实现部分分离，使它们都可以独立地变化</li><li>通过组合的方式建立两个类之间联系，而不是继承</li></ul><hr><p><strong>适用场景</strong></p><ul><li>如果希望在几个独立维度上扩展一个类， 可使用该模式</li><li>如果需要在运行时切换不同实现方法， 可使用桥接模式（使用聚合实现）</li><li>不希望使用继承，或因为多层继承导致系统类的个数剧增</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>分离抽象部分及其具体实现部分</li><li>提高了系统的可扩展性</li><li>客户端代码仅与高层抽象部分进行互动， 不会接触到平台的详细信息（桥接是两个继承体系抽象层的聚合）</li></ul><p>缺点</p><ul><li>增加了系统的理解与设计难度</li><li>需要正确地识别出系统中两个独立变化的维度</li></ul><hr><p><strong>与其他设计模式对比</strong></p><p><code>桥接模式和组合模式</code></p><ul><li><a href="#%E7%BB%84%E5%90%88">组合模式</a>：强调的是部分和整体的组合</li><li>桥接模式：强调平行级别上不同类的组合</li></ul><p><code>桥接模式和适配器模式</code></p><ul><li>共同点：都是让两个不同的对象配合工作</li><li>不同点<ul><li><a href="#%E9%80%82%E9%85%8D%E5%99%A8">适配器模式</a>：改变已有的接口，让它们之间可以相互配合，让功能上相似但接口不同的类适配起来</li><li>桥接模式：分离抽象和具体的实现，目的是分离。在分离的基础上使这些层次结合起来</li></ul></li></ul><hr><p><strong>模拟场景</strong></p><p>中国有很多家银行，每家银行又有储蓄卡和信用卡。模拟聚合支付平台查询用户的金额</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8FUML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 银行（抽象层聚合）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Bank</span> &#123;<br>    <span class="hljs-keyword">protected</span> Card card;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Bank</span><span class="hljs-params">(Card card)</span> &#123;<br>        <span class="hljs-built_in">this</span>.card = card;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-type">float</span> <span class="hljs-title function_">query</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 中国农业银行</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ABCBank</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Bank</span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ABCBank</span><span class="hljs-params">(Card card)</span> &#123;<br>        <span class="hljs-built_in">super</span>(card);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">query</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;查询中国农业银行余额&quot;</span>);<br>        <span class="hljs-keyword">return</span> card.getTotal();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 中国工商银行</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ICBCBank</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Bank</span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ICBCBank</span><span class="hljs-params">(Card card)</span> &#123;<br>        <span class="hljs-built_in">super</span>(card);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">query</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;查询中国工商银行余额&quot;</span>);<br>        <span class="hljs-keyword">return</span> card.getTotal();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 银行卡</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Card</span> &#123;<br>    <span class="hljs-comment">// 获取余额</span><br>    <span class="hljs-type">float</span> <span class="hljs-title function_">getTotal</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 储蓄卡</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BankCard</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Card</span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> debit;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BankCard</span><span class="hljs-params">(<span class="hljs-type">float</span> debit)</span> &#123;<br>        <span class="hljs-built_in">this</span>.debit = debit;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getTotal</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;读取储蓄卡，余额：&quot;</span> + <span class="hljs-built_in">this</span>.debit);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.debit;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 信用卡</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreditCard</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Card</span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> debit;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CreditCard</span><span class="hljs-params">(<span class="hljs-type">float</span> debit)</span> &#123;<br>        <span class="hljs-built_in">this</span>.debit = debit;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getTotal</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;读取信用卡，余额：&quot;</span> + <span class="hljs-built_in">this</span>.debit);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.debit;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 中国农业银行储蓄卡</span><br>        <span class="hljs-type">ABCBank</span> <span class="hljs-variable">abcBank</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ABCBank</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BankCard</span>(<span class="hljs-number">100.f</span>));<br>        abcBank.query();<br><br>        <span class="hljs-comment">// 中国农业银行信用卡</span><br>        abcBank = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ABCBank</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CreditCard</span>(<span class="hljs-number">500.f</span>));<br>        abcBank.query();<br><br>        <span class="hljs-comment">// 中国工商银行信用卡</span><br>        <span class="hljs-type">ICBCBank</span> <span class="hljs-variable">icbcBank</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ICBCBank</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CreditCard</span>(<span class="hljs-number">1000.f</span>));<br>        icbcBank.query();<br>    &#125;<br>&#125;<br><span class="hljs-comment">// 输出</span><br>查询中国农业银行余额<br>读取储蓄卡，余额：<span class="hljs-number">100.0</span><br>查询中国农业银行余额<br>读取信用卡，余额：<span class="hljs-number">500.0</span><br>查询中国工商银行余额<br>读取信用卡，余额：<span class="hljs-number">1000.0</span><br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p><strong>JDK</strong></p><p>JDK数据库连接（JDBC）的<code>Driver</code>接口，不同的数据库厂商都实现了<code>Driver</code>接口。通过各自的<code>Driver</code>都可以获取各自的数据连接<code>Connection</code>。数据库<code>Driver</code>是一个独立扩展体系，而数据库的<code>Connection</code>是另一个独立的扩展体系</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8FDriver.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8FJDBC.png" srcset="/img/loading.gif" lazyload alt></p></blockquote><h4 id="代理"><a class="markdownIt-Anchor" href="#代理"></a> 代理</h4><blockquote><p><code>控制目标对象的访问</code> <code>代理模式导致执行效率降低</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1%E7%A4%BA%E6%84%8F%E5%9B%BE1.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1%E7%A4%BA%E6%84%8F%E5%9B%BE2.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li>为其他对象提供一种代理，以控制对这个对象的访问</li><li>代理对象在客户端和目标对象之间起到中介的作用</li></ul><hr><p><strong>适用场景</strong></p><ul><li>保护目标对象</li><li>增强目标对象</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>代理模式能将代理对象与真实被调用的目标对象分离</li><li>一定程度上降低了系统的耦合度，扩展性好</li><li>保护目标对象</li><li>增强目标对象</li></ul><p>缺点</p><ul><li>代理模式会造成系统设计中类的数目增加</li><li>在客户端和目标对象增加一个代理对象，会造成请求处理速度变慢</li><li>增加系统的复杂度</li></ul><hr><p><strong>扩展</strong></p><ul><li><code>静态代理</code>： 代理模式</li><li><code>动态代理</code>：InvocationHandler（无法代理类，动态代理接口）</li><li><code>CGLib代理</code>：字节码增强（无法增强final）</li><li><code>Spring</code>：当有实现接口时使用JDK动态代理，否则使用CGLib代理</li><li><code>性能对比</code>：JDK &gt; CGLib</li></ul><hr><p><strong>角色说明</strong></p><ul><li><code>服务接口</code>：声明了服务接口。 代理必须遵循该接口才能伪装成服务对象</li><li><code>服务</code>：实现服务接口，实现业务逻辑</li><li><code>代理</code>：代理对象和服务是组合关系，代理对象控制服务对象并且实现服务接口以实现对服务对象的代理</li></ul><hr><p><strong>与其他设计模式对比</strong></p><p><code>代理模式和装饰者模式</code></p><p>相同点</p><ul><li>两种从设计模式分类来看都属于结构型，因为两者均使用了组合关系。其次两者都能实现对对象方法进行增强处理的效果</li></ul><p>不同点</p><ul><li><a href="#%E8%A3%85%E9%A5%B0%E8%80%85">装饰者模式</a>：注重的是对对象提供增强功能</li><li>代理模式：对所代理对象的使用施加控制，并不提供对象本身的增强功能</li></ul><p><code>代理模式和适配器模式</code></p><ul><li><a href="#%E9%80%82%E9%85%8D%E5%99%A8">适配器模式</a>：主要改变所考虑对象的接口（类a转变为类b）</li><li>代理模式：不能改变所考虑类的接口</li></ul><hr><p><strong>源码解析</strong></p><p><strong>Spring</strong></p><p>spring的代理模式在<code>aop</code>中有体现，如果目标类有接口实现则使用JDK动态代理<code>JdkDynamicAopProxy</code>否则使用<code>CglibAopProxy</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Spring%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/SpringCGLib%E4%BB%A3%E7%90%86.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>Mybatis</strong></p><p>mybatis的<code>Mapper</code>接口动态代理实现</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Mybatis%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%861.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Mybatis%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%862.png" srcset="/img/loading.gif" lazyload alt></p></blockquote><h5 id="静态代理"><a class="markdownIt-Anchor" href="#静态代理"></a> 静态代理</h5><blockquote><p><strong>模拟场景</strong>：给Dao层添加代理，如果本地缓存有数据则控制获取本地缓存数据，否则获取数据库数据</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86UML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderDao</span> &#123;<br>    <span class="hljs-comment">// 查询订单编号</span><br>    String <span class="hljs-title function_">selectOrderOn</span><span class="hljs-params">(Integer id)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderDao</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">selectOrderOn</span><span class="hljs-params">(Integer id)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;数据库查询&quot;</span>);<br>        <span class="hljs-keyword">return</span> UUID.randomUUID().toString();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderDaoImplProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderDao</span> &#123;<br>    <span class="hljs-keyword">private</span> Map&lt;Integer, String&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    <span class="hljs-comment">// 装饰者一般是传入一个目标对象进行增强，而代理模式则是在代理中直接创建对象</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">OrderDaoImpl</span> <span class="hljs-variable">orderDaoImpl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderDaoImpl</span>();<br><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">beforeMethod</span><span class="hljs-params">(Integer id)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">orderNo</span> <span class="hljs-operator">=</span> cache.get(id);<br><br>        <span class="hljs-comment">// 施加控制，如果缓存有数据直接返回，否则查询数据库</span><br>        <span class="hljs-keyword">if</span> (orderNo != <span class="hljs-literal">null</span>) &#123;<br>            System.out.println(<span class="hljs-string">&quot;缓存数据返回&quot;</span>);<br>            <span class="hljs-keyword">return</span> orderNo;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">selectOrderOn</span><span class="hljs-params">(Integer id)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">orderNo</span> <span class="hljs-operator">=</span> beforeMethod(id);<br><br>        <span class="hljs-comment">// 缓存没有数据库加载</span><br>        <span class="hljs-keyword">if</span> (orderNo == <span class="hljs-literal">null</span>) &#123;<br>            orderNo = orderDaoImpl.selectOrderOn(id);<br>            cache.put(id, orderNo);<br>        &#125;<br><br>        afterMethod();<br>        <span class="hljs-keyword">return</span> orderNo;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterMethod</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;执行静态代理方法&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">OrderDao</span> <span class="hljs-variable">orderDao</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderDaoImplProxy</span>();<br>        orderDao.selectOrderOn(<span class="hljs-number">1</span>);<br>        orderDao.selectOrderOn(<span class="hljs-number">1</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">// 输出</span><br>数据库查询<br>执行静态代理方法<br>缓存数据返回<br>执行静态代理方法<br></code></pre></td></tr></table></figure></blockquote><h5 id="动态代理"><a class="markdownIt-Anchor" href="#动态代理"></a> 动态代理</h5><blockquote><ul><li>代理类需要实现<code>InvocationHandler</code>接口并且实现<code>invoke</code>方法</li><li>通过<code>Proxy.newProxyInstance</code>创建代理实例</li></ul><p><strong>模拟场景</strong>：模拟Mybatis对Mapper接口的动态代理</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 代理接口</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>    Map&lt;Object, Object&gt; <span class="hljs-title function_">selectById</span><span class="hljs-params">(Integer id)</span>;<br><br>    Integer <span class="hljs-title function_">deleteById</span><span class="hljs-params">(Integer id)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 代理类</span><br><span class="hljs-comment"> * InvocationHandler 实现类</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapperProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">MapperImpl</span> <span class="hljs-variable">mapperImpl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MapperImpl</span>();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-comment">// 调用Object方法</span><br>        <span class="hljs-keyword">if</span> (Object.class.equals(method.getDeclaringClass())) &#123;<br>            <span class="hljs-keyword">return</span> method.invoke(<span class="hljs-built_in">this</span>, args);<br>        &#125;<br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (method.getName().startsWith(<span class="hljs-string">&quot;select&quot;</span>)) &#123;<br>            result = <span class="hljs-built_in">this</span>.mapperImpl.select(args[<span class="hljs-number">0</span>]);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (method.getName().startsWith(<span class="hljs-string">&quot;update&quot;</span>)<br>                || method.getName().startsWith(<span class="hljs-string">&quot;insert&quot;</span>)<br>                || method.getName().startsWith(<span class="hljs-string">&quot;delete&quot;</span>)) &#123;<br>            result = <span class="hljs-built_in">this</span>.mapperImpl.update(args[<span class="hljs-number">0</span>]);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Mapper 通用实现类</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapperImpl</span> &#123;<br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">select</span><span class="hljs-params">(Object param)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;执行查询语句，参数：&quot;</span> + param.toString());<br>        <span class="hljs-comment">// 模拟返回数据</span><br>        Map&lt;String, Object&gt; resultMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        resultMap.put(<span class="hljs-string">&quot;name&quot;</span>, UUID.randomUUID().toString());<br>        <span class="hljs-keyword">return</span> resultMap;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">update</span><span class="hljs-params">(Object param)</span> &#123;<br>        <span class="hljs-comment">// 底层都是调用JDBC的 Statement.executeUpdate(sql);</span><br>        System.out.println(<span class="hljs-string">&quot;执行 新增|修改|删除 语句，参数：&quot;</span> + param.toString());<br>        <span class="hljs-comment">// 模拟返回受影响行数</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">MapperProxy</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MapperProxy</span>();<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 第一个是参数是代理对象的类加载器</span><br><span class="hljs-comment">         * 第二个参数是代理接口数组</span><br><span class="hljs-comment">         * 第三个参数是 InvocationHandler的具体实现类，接口的所有代理实现都在 invoke 中实现</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">UserMapper</span> <span class="hljs-variable">userMapper</span> <span class="hljs-operator">=</span> (UserMapper) Proxy.newProxyInstance(MapperImpl.class.getClassLoader(),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;UserMapper.class&#125;, proxy);<br><br>        Map&lt;Object, Object&gt; resultMap = userMapper.selectById(<span class="hljs-number">1</span>);<br>        System.out.println(<span class="hljs-string">&quot;selectById 返回值：&quot;</span> + resultMap);<br><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> userMapper.deleteById(<span class="hljs-number">10</span>);<br>        System.out.println(<span class="hljs-string">&quot;deleteById 返回值：&quot;</span> + result);<br>    &#125;<br>&#125;<br><span class="hljs-comment">// 输出</span><br>执行查询语句，参数：<span class="hljs-number">1</span><br>selectById 返回值：&#123;name=ab1de88a-cb57-461a-acea-d111f481a7c0&#125;<br>执行 新增|修改|删除 语句，参数：<span class="hljs-number">10</span><br>deleteById 返回值：<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></blockquote><h5 id="cglib动态字节码代理"><a class="markdownIt-Anchor" href="#cglib动态字节码代理"></a> CGLib动态字节码代理</h5><blockquote><p><strong>CGlib的核心是 MethodInterceptor接口和 Enhancer字节码增强类</strong></p><p>Maven依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cglib<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>cglib<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Movie</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">play</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;播放电影&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * cglib核心 MethodInterceptor 接口对方法拦截</span><br><span class="hljs-comment"> * Enhancer 字节码增强类</span><br><span class="hljs-comment"> * 原理，通过cglib字节码增强生成目标类的子类达到增强目的</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 字节码增强对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取cglib增强对象</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> clazz</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;T&gt;</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">getProxy</span><span class="hljs-params">(Class&lt;T&gt; clazz)</span> &#123;<br>        <span class="hljs-comment">// 将指定类设置为增强类的父类</span><br>        enhancer.setSuperclass(clazz);<br>        enhancer.setCallback(<span class="hljs-built_in">this</span>);<br>        <span class="hljs-keyword">return</span> (T) enhancer.create();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 拦截被增强类的方法，在 invokeSuper</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> o</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> method</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> objects</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> methodProxy</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Throwable</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        System.out.println(<span class="hljs-string">&quot;增强：播放公益广告&quot;</span>);<br><br>        <span class="hljs-comment">// 调用父类方法，相当于重写父类方法并且在这里调用了父类的方法（super.method）</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> methodProxy.invokeSuper(o, objects);<br>        System.out.println(<span class="hljs-string">&quot;增强：播放彩蛋&quot;</span>);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">CglibProxy</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CglibProxy</span>();<br><br>        <span class="hljs-comment">// 获取字节码增强类</span><br>        <span class="hljs-type">Movie</span> <span class="hljs-variable">movie</span> <span class="hljs-operator">=</span> proxy.getProxy(Movie.class);<br>        movie.play();<br>        System.out.println(movie.getClass());<br>    &#125;<br>&#125;<br><span class="hljs-comment">// 输出</span><br>增强：播放公益广告<br>播放电影<br>增强：播放彩蛋<br></code></pre></td></tr></table></figure></blockquote><h3 id="行为型"><a class="markdownIt-Anchor" href="#行为型"></a> 行为型</h3><h4 id="模板方法"><a class="markdownIt-Anchor" href="#模板方法"></a> 模板方法</h4><blockquote><p><code>定义一个算法骨架，具体子类实现</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li>定义了一个算法的骨架，并允许子类为一个或多个步骤提供实现</li><li>模板方法使得子类可以在不改变算法结构的情况下，重写算法的特定步骤</li></ul><hr><p><strong>适用场景</strong></p><ul><li>一次性实现一个算法的不变的部分，并将可变的行为留给子类来实现</li><li>各子类中公共的行为被提取出来并集中到一个公共父类中从而避免代码重复</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>提高复用性</li><li>提高扩展性</li></ul><p>缺点</p><ul><li>类数目增加</li><li>增加了系统实现的复杂度</li><li>继承关系自身缺点，如果父类添加新的抽象方法，所有子类都要改一遍</li></ul><hr><p><strong>扩展</strong></p><ul><li>钩子方法：提供了缺省的行为，子类可以在必要时进行扩展</li></ul><hr><p><strong>角色说明</strong></p><ul><li><code>抽象类</code>：声明作为算法步骤的方法， 以及依次调用它们的实际模板方法（算法骨架）</li><li><code>具体类</code>：可以重写所有步骤， 但不能重写模板方法自身</li></ul><hr><p><strong>与其他设计模式对比</strong></p><p><code>模板方法模式和工厂方法模式</code></p><ul><li><a href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95">工厂方法</a>：是模板方法的一种特殊实现</li></ul><p><code>模板方法模式和策略模式</code></p><ul><li><a href="#%E7%AD%96%E7%95%A5">策略模式</a>：目的是使不同的算法可以相互替换并且不影响应用层客户端的使用，可以改变算法的流程并且可以相互替换</li><li>模板方法模式：针对的是定义一个算法的流程，而将一些实现步骤交给子类去实现，不改变算法的流程</li></ul><hr><p><strong>模拟场景</strong></p><p>泡茶和泡咖啡的流程大致是一样的，烧水-放调料（茶叶/咖啡粉）-装杯，咖啡有可选是否加糖</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95UML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 饮料（抽象类）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Drinks</span> &#123;<br>    <span class="hljs-comment">// 定义算法骨架,使用final修饰，不允许子类修改算法流程</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">make</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.boilWater();<br>        <span class="hljs-built_in">this</span>.seasoning();<br>        <span class="hljs-built_in">this</span>.pourOut();<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.needSugar()) &#123;<br>            <span class="hljs-built_in">this</span>.addSugar();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 烧水 某个步骤如果是固化的则可以使用 final 修饰不让子类修改</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">boilWater</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;开始烧水&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 调料</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seasoning</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">// 装杯</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pourOut</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">// 钩子方法 是否需要加糖</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">needSugar</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">// 加糖</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addSugar</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;加糖&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 茶（具体类）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Tea</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Drinks</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seasoning</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;放茶叶&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pourOut</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;装入茶杯&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">needSugar</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 咖啡（具体类）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Coffee</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Drinks</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> addSugar;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Coffee</span><span class="hljs-params">(<span class="hljs-type">boolean</span> addSugar)</span> &#123;<br>        <span class="hljs-built_in">this</span>.addSugar = addSugar;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seasoning</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;放入咖啡粉&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pourOut</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;装入咖啡杯&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">needSugar</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.addSugar;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Drinks</span> <span class="hljs-variable">drinks</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tea</span>();<br>        drinks.make();<br><br>        System.out.println();<br>        drinks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Coffee</span>(<span class="hljs-literal">true</span>);<br>        drinks.make();<br>    &#125;<br>&#125;<br><span class="hljs-comment">// 输出</span><br>开始烧水<br>放茶叶<br>装入茶杯<br><br>开始烧水<br>放入咖啡粉<br>装入咖啡杯<br>加糖<br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p><strong>JDK</strong></p><p>jdk类<code>AbstractList#addAll</code>方法就有很多实现</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95AbstractList.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95AbstractList2.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>Mybatis</strong></p><p>Mybatis的<code>Executor</code>体系就是通过模板方法模式扩展出适应多个场景使用的执行器</p><p><code>BaseExecutor#query 方法</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95Mybatis.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95Mybatis2.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>Spring</strong></p><p>Spring<code>AbstractApplicationContext#refresh</code>方法实现了 IOC 容器启动的主要逻辑，不管是 XML 还是注解配置的方式，对于核心容器启动流程都是一致的</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95Spring.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95Spring2.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>Spring Template</strong></p><p>JDBCTemplate、RedisTemplate、MQTemplate都是使用模板方法实现的框架，它们都实现了<span style="border-bottom:2px dashed green">获取连接、执行命令、释放连接这一基本流程</span></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8FRedisTemplate.png" srcset="/img/loading.gif" lazyload alt></p></blockquote><h4 id="迭代器"><a class="markdownIt-Anchor" href="#迭代器"></a> 迭代器</h4><blockquote><p><code>迭代集合，很少自定义实现</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li>提供一种方法，顺序访问一个集合对象中的各个元素，而又不暴露该对象的内部表示</li></ul><hr><p><strong>适用场景</strong></p><ul><li>访问一个集合对象的内容而无需暴露它的内部表示</li><li>为遍历不同的集合结构提供一个统一的接口</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>分离了集合对象的遍历行为</li></ul><p>缺点</p><ul><li>类的数目增加</li></ul><hr><p><strong>迭代器模式和访问者模式</strong></p><ul><li>相同点：都是迭代的访问集合对象中的各个元素</li><li>不同点<ul><li>访问者模式：扩展和开放的部分在作用于对象的操作上</li><li>访问者模式：扩展和开放的部分是在集合的种类型</li></ul></li></ul><hr><p><strong>模拟场景</strong></p><p>一个班级有多个学生，班级可以接受插班生，也可以开除顽皮的学生。上课点名班上所有同学</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%BF%AD%E4%BB%A3%E5%99%A8UML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 学生</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-meta">@ToString</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String no, String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.no = no;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String no;<br>    <span class="hljs-keyword">private</span> String name;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 学生迭代器</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">StudentIterator</span> &#123;<br>    Student <span class="hljs-title function_">nextStudent</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isLastStudent</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 学生迭代器实现</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentIteratorImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">StudentIterator</span> &#123;<br>    <span class="hljs-keyword">private</span> List&lt;Student&gt; studentList;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> position;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">StudentIteratorImpl</span><span class="hljs-params">(List&lt;Student&gt; classList)</span> &#123;<br>        <span class="hljs-built_in">this</span>.studentList = classList;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Student <span class="hljs-title function_">nextStudent</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (position &lt; studentList.size()) &#123;<br>            <span class="hljs-keyword">return</span> studentList.get(position++);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isLastStudent</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (position == studentList.size()) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 班级</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Class</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">addStudent</span><span class="hljs-params">(Student student)</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">removeStudent</span><span class="hljs-params">(Student student)</span>;<br><br>    <span class="hljs-comment">// 获取迭代器</span><br>    StudentIterator <span class="hljs-title function_">getIterator</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 班级实现</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Class</span> &#123;<br>    <span class="hljs-keyword">private</span> List&lt;Student&gt; list;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ClassImpl</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Student&gt;();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addStudent</span><span class="hljs-params">(Student student)</span> &#123;<br>        <span class="hljs-built_in">this</span>.list.add(student);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">removeStudent</span><span class="hljs-params">(Student student)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.list.remove(student);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> StudentIterator <span class="hljs-title function_">getIterator</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StudentIteratorImpl</span>(list);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public <span class="hljs-keyword">class</span> Example &#123;<br>    public static void main(String<span class="hljs-literal">[]</span> args) &#123;<br>        Class clazz = <span class="hljs-keyword">new</span> <span class="hljs-constructor">ClassImpl()</span>;<br>        Student student1 = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Student(<span class="hljs-string">&quot;001&quot;</span>, <span class="hljs-string">&quot;张三&quot;</span>)</span>;<br>        Student student2 = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Student(<span class="hljs-string">&quot;002&quot;</span>, <span class="hljs-string">&quot;李四&quot;</span>)</span>;<br>        Student student3 = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Student(<span class="hljs-string">&quot;003&quot;</span>, <span class="hljs-string">&quot;王五&quot;</span>)</span>;<br>        Student student4 = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Student(<span class="hljs-string">&quot;004&quot;</span>, <span class="hljs-string">&quot;陆六&quot;</span>)</span>;<br>        Student student5 = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Student(<span class="hljs-string">&quot;005&quot;</span>, <span class="hljs-string">&quot;陈七&quot;</span>)</span>;<br><br>        clazz.add<span class="hljs-constructor">Student(<span class="hljs-params">student1</span>)</span>;<br>        clazz.add<span class="hljs-constructor">Student(<span class="hljs-params">student2</span>)</span>;<br>        clazz.add<span class="hljs-constructor">Student(<span class="hljs-params">student3</span>)</span>;<br>        clazz.add<span class="hljs-constructor">Student(<span class="hljs-params">student4</span>)</span>;<br>        clazz.add<span class="hljs-constructor">Student(<span class="hljs-params">student5</span>)</span>;<br><br>        clazz.remove<span class="hljs-constructor">Student(<span class="hljs-params">student4</span>)</span>;<br>        clazz.remove<span class="hljs-constructor">Student(<span class="hljs-params">student5</span>)</span>;<br><br>        StudentIterator iterator = clazz.get<span class="hljs-constructor">Iterator()</span>;<br>        <span class="hljs-keyword">while</span> (!iterator.is<span class="hljs-constructor">LastStudent()</span>) &#123;<br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(iterator.next<span class="hljs-constructor">Student()</span>);<br>        &#125;<br>    &#125;<br>&#125;<br>输出：<br>Student&#123;no=&#x27;<span class="hljs-number">001</span>&#x27;, name=&#x27;张三&#x27;&#125;<br>Student&#123;no=&#x27;<span class="hljs-number">002</span>&#x27;, name=&#x27;李四&#x27;&#125;<br>Student&#123;no=&#x27;<span class="hljs-number">003</span>&#x27;, name=&#x27;王五&#x27;&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p><strong>Mybatis</strong></p><p>Mybatis的默认游标<code>DefaultCursor</code>就自定义实现了迭代器<code>CursorIterator</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%BF%AD%E4%BB%A3%E5%99%A8Mybatis.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%BF%AD%E4%BB%A3%E5%99%A8Mybatis2.png" srcset="/img/loading.gif" lazyload alt></p></blockquote><h4 id="策略"><a class="markdownIt-Anchor" href="#策略"></a> 策略</h4><blockquote><p><code>田忌赛马，算法替换</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li>它能让你定义一系列算法， 并将每种算法分别放入独立的类中， 以使算法的对象能够相互替换</li><li>如果代码中有很多<code>if...else..</code>则可以使用策略模式优雅替换</li></ul><hr><p><strong>适用场景</strong></p><ul><li>系统有很多类，而他们的区别仅仅在于他们的行为不同</li><li>一个系统需要动态地在几种算法中选择一种</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>避免使用多重条件转移语句</li><li>提高算法的保密性和安全性</li></ul><p>缺点</p><ul><li>客户端必须知道所有的策略类，并自行决定使用哪一个策略类</li><li>产生很多策略类</li></ul><hr><p><strong>角色说明</strong></p><ul><li><code>上下文</code>：维护指向具体策略的引用， 且仅通过策略接口与该对象进行交流（算法相互替换的关键）</li><li><code>策略接口</code>：具体策略的通用接口， 它声明了一个上下文用于执行策略的方法</li><li><code>具体策略</code>：实现了上下文所用算法的各种不同变体</li></ul><hr><p><strong>与其他设计模式对比</strong></p><p><code>策略模式和工厂模式</code></p><ul><li><p><a href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95">工厂模式</a>：创建型模式，工厂模式接收指令，创建符合要求的具体对象</p></li><li><p>策略模式：行为型模式，策略模式接收创建好的对象，从而实现不同的行为</p></li></ul><hr><p><code>策略模式和状态模式</code></p><ul><li>策略模式：客户端在使用时必须知道使用哪种策略</li><li><a href="#%E7%8A%B6%E6%80%81">状态模式</a>：客户端不需要关心具体的状态，状态会自动转换</li></ul><hr><p><strong>模拟场景</strong></p><p>GPS地图导航系统的导航出行方案有步行、骑行、公交、地铁、驾车方案，使用策略模式优化大量 if…else 判断</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8FUML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 出行策略</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Strategy</span> &#123;<br>    <span class="hljs-comment">// 出行</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOff</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 步行出行</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WalkStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Strategy</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOff</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;步行路线导航&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 骑行出行</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RideStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Strategy</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOff</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;骑行路线导航&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 公交出行</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BusStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Strategy</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOff</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;公交路线导航&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 地铁出行</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SubwayStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Strategy</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOff</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;地铁路线导航&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 驾车出行</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DriveStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Strategy</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOff</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;驾车路线导航&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 空策略，用于兼容</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmptyStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Strategy</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOff</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;空策略，兼容&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 上下文</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StrategyContext</span> &#123;<br>    <span class="hljs-keyword">private</span> Strategy strategy;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">StrategyContext</span><span class="hljs-params">(Strategy strategy)</span> &#123;<br>        <span class="hljs-built_in">this</span>.strategy = strategy;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeStrategy</span><span class="hljs-params">()</span> &#123;<br>        strategy.setOff();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 策略工厂</span><br><span class="hljs-comment"> * 缓存工厂</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StrategyFactory</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">StrategyFactory</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, Strategy&gt; STRATEGY_CONTAINER = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>    <span class="hljs-comment">// 初始化</span><br>    <span class="hljs-keyword">static</span> &#123;<br>        STRATEGY_CONTAINER.put(<span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">EmptyStrategy</span>());<br>        STRATEGY_CONTAINER.put(StrategyKey.WALK, <span class="hljs-keyword">new</span> <span class="hljs-title class_">WalkStrategy</span>());<br>        STRATEGY_CONTAINER.put(StrategyKey.RIDE, <span class="hljs-keyword">new</span> <span class="hljs-title class_">RideStrategy</span>());<br>        STRATEGY_CONTAINER.put(StrategyKey.BUS, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusStrategy</span>());<br>        STRATEGY_CONTAINER.put(StrategyKey.SUBWAY, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SubwayStrategy</span>());<br>        STRATEGY_CONTAINER.put(StrategyKey.DRIVE, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DriveStrategy</span>());<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Strategy <span class="hljs-title function_">getStrategy</span><span class="hljs-params">(String strategyKey)</span> &#123;<br>        <span class="hljs-type">Strategy</span> <span class="hljs-variable">strategy</span> <span class="hljs-operator">=</span> STRATEGY_CONTAINER.get(strategyKey);<br>        <span class="hljs-keyword">if</span> (Objects.isNull(strategy)) &#123;<br>            strategy = STRATEGY_CONTAINER.get(<span class="hljs-literal">null</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> strategy;<br>    &#125;<br><br>    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">StrategyKey</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">WALK</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;WALK&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">RIDE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;RIDE&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">BUS</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;BUS&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">SUBWAY</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SUBWAY&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">DRIVE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;DRIVE&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> StrategyFactory.StrategyKey.BUS;<br>        <span class="hljs-type">StrategyContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StrategyContext</span>(StrategyFactory.getStrategy(key));<br>        context.executeStrategy();<br><br>        <span class="hljs-comment">// 算法替换</span><br>        key = StrategyFactory.StrategyKey.SUBWAY;<br>        context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StrategyContext</span>(StrategyFactory.getStrategy(key));<br>        context.executeStrategy();<br>        <span class="hljs-comment">// 输出</span><br>        <span class="hljs-comment">// 公交路线导航</span><br>        <span class="hljs-comment">// 地铁路线导航</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>源码详解</strong></p><p><strong>JDK</strong></p><p>JDK的排序接口<code>Comparator</code>就是使用策略模式进行各种类型的数据排序，<code>Collections#sort</code>方法就是要传递一个自定义的<code>Comparator&lt;? super T&gt;</code>对集合进行排序</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8FJDK.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>Spring</strong></p><p><code>InstantiationStrategy</code> 接口定义了 Spring Bean 实例化的策略，有简单通过构造函数或者方法工厂创建的，也有通过使用Cglib字节码增强创建的</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8FSpring.png" srcset="/img/loading.gif" lazyload alt></p></blockquote><h4 id="解释器"><a class="markdownIt-Anchor" href="#解释器"></a> 解释器</h4><blockquote><p><code>非常低频使用</code></p><p><strong>定义</strong></p><ul><li>给定一个语言，定义它的文法的一种表示，并定义一个解释器这个解释器使用该表示来解释语言中的句子</li><li>为了解释一种语言，而为语言创建的解释器</li></ul><hr><p><strong>适用场景</strong></p><ul><li>某个特定类型问题发生频率足够高</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>语法由很多类表示，容易改变及扩展此<code>语言</code></li></ul><p>缺点</p><ul><li>当语法规则数目太多时，增加了系统复杂度</li></ul><hr><p><strong>解释器模式和适配器模式</strong></p><ul><li>适配器：不需要事先知道要适配的规则</li><li>解释器：需要事先写好规则，根据规则去进行解释</li></ul><hr><p><strong>模拟场景</strong></p><p>实现一个简单的加减法数学公式计算器，比如计算<code>3 + 10</code>这个字符串的和</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A7%A3%E9%87%8A%E5%99%A8UML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 表达式</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Expression</span> &#123;<br>    <span class="hljs-comment">// 解释</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">interpret</span><span class="hljs-params">(String str)</span>;<br><br>    <span class="hljs-keyword">static</span> List&lt;Integer&gt; <span class="hljs-title function_">parse</span><span class="hljs-params">(String str)</span> &#123;<br>        List&lt;String&gt; collect = Arrays.stream(str.split(<span class="hljs-string">&quot; &quot;</span>))<br>                .filter(line -&gt; &#123;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;&quot;</span>.equals(line) || <span class="hljs-literal">null</span> == line) &#123;<br>                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>                    &#125;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                &#125;).collect(Collectors.toList());<br><br>        <span class="hljs-keyword">return</span> Arrays.asList(Integer.valueOf(collect.get(<span class="hljs-number">0</span>)), Integer.valueOf(collect.get(<span class="hljs-number">2</span>)));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 加法表达式</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AddExpression</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Expression</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">interpret</span><span class="hljs-params">(String str)</span> &#123;<br>        List&lt;Integer&gt; list = Expression.parse(str);<br>        <span class="hljs-keyword">return</span> list.get(<span class="hljs-number">0</span>) + list.get(<span class="hljs-number">1</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 减法表达式</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SubExpression</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Expression</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">interpret</span><span class="hljs-params">(String str)</span> &#123;<br>        List&lt;Integer&gt; list = Expression.parse(str);<br>        <span class="hljs-keyword">return</span> list.get(<span class="hljs-number">0</span>) - list.get(<span class="hljs-number">1</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 工具类</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OperatorUtil</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">operator</span><span class="hljs-params">(String str)</span> &#123;<br>        <span class="hljs-type">Expression</span> <span class="hljs-variable">expression</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (str.contains(<span class="hljs-string">&quot;+&quot;</span>)) &#123;<br>            expression = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AddExpression</span>();<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (str.contains(<span class="hljs-string">&quot;-&quot;</span>)) &#123;<br>            expression = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SubExpression</span>();<br>        &#125;<br>        <span class="hljs-keyword">return</span> expression.interpret(str);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;2 + 3&quot;</span>;<br>        System.out.println(str + <span class="hljs-string">&quot; 解释器解释结果：&quot;</span> + OperatorUtil.operator(str));<br><br>        str = <span class="hljs-string">&quot;3 - 7&quot;</span>;<br>        System.out.println(str + <span class="hljs-string">&quot; 解释器解释结果：&quot;</span> + OperatorUtil.operator(str));<br>    &#125;<br>&#125;<br><span class="hljs-comment">// 输出</span><br><span class="hljs-number">2</span> + <span class="hljs-number">3</span> 解释器解释结果：<span class="hljs-number">5</span><br><span class="hljs-number">3</span> - <span class="hljs-number">7</span> 解释器解释结果：-<span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p><strong>JDK</strong></p><p>JDK工具类<code>Pattern</code>用于解释正则表达式语法</p><p><strong>Spring</strong></p><p>Spring的<code>EL表达式</code>也是使用解释器进行表达式解释</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ExpressionParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpelExpressionParser</span>();<br>        <span class="hljs-type">Expression</span> <span class="hljs-variable">expression</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;10 + 10 * 10&quot;</span>);<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> expression.getValue(Integer.class);<br>        System.out.println(result);<br>        <span class="hljs-comment">// 输出 110</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></blockquote><h4 id="观察者"><a class="markdownIt-Anchor" href="#观察者"></a> 观察者</h4><blockquote><p><code>一对多</code> <code>订阅机制</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li>定义了对象之间的一对多依赖，让多个观察者对象同时监听某个主题对象，当主题对象发生变化时，它的所有依赖者(观察者)都会收到通知并更新</li></ul><hr><p><strong>适用场景</strong></p><ul><li>关联行为场景，建立一套触发机制</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>观察者和被观察者之间建立一个抽象的耦合</li><li>观察者模式支持广播通信</li></ul><p>缺点</p><ul><li>观察者之间有过多的细节依赖、提高时间消耗及程序复杂度</li><li>使用要得当，要避免循环调用</li></ul><hr><p><strong>角色说明</strong></p><ul><li><code>发布者</code>：会向其他对象发送值得关注的事件。 事件会在发布者自身状态改变或执行特定行为后发生。 发布者中包含一个允许新订阅者加入和当前订阅者离开列表的订阅构架</li><li><code>订阅者</code>：接口声明了通知接口。 在绝大多数情况下， 该接口仅包含一个 update 更新方法</li><li><code>具体订阅者</code>：可以执行一些操作来回应发布者的通知。 所有具体订阅者类都实现了同样的接口， 因此发布者不需要与具体类相耦合</li></ul><hr><p><strong>模拟场景</strong></p><p>微信群聊天，聊天室是消息发布者，微信用户是订阅者（登录），微信客户端是具体订阅者（展示消息）</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A7%82%E5%AF%9F%E8%80%85UML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 聊天室 (发布者)</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Chatroom</span> &#123;<br><br>    <span class="hljs-comment">// 当前消息</span><br>    <span class="hljs-keyword">private</span> String currentMsg;<br><br>    <span class="hljs-comment">// 聊天室成员</span><br>    <span class="hljs-keyword">private</span> List&lt;WxUser&gt; userList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-comment">// 添加成员</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addUser</span><span class="hljs-params">(Observer observer)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userList.add(observer);<br>    &#125;<br><br>    <span class="hljs-comment">// 发送群消息</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMsg</span><span class="hljs-params">(String msg)</span> &#123;<br>        <span class="hljs-built_in">this</span>.currentMsg = msg;<br>        <span class="hljs-comment">// 消息通知</span><br>        <span class="hljs-built_in">this</span>.notifyAllObservers();<br>    &#125;<br><br>    <span class="hljs-comment">// 群消息通知</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyAllObservers</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">for</span> (WxUser wxUser : userList) &#123;<br>            wxUser.receive(<span class="hljs-built_in">this</span>.currentMsg);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 微信用户（订阅者）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WxUser</span> &#123;<br>    <span class="hljs-keyword">private</span> Chatroom chatroom;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WxUser</span><span class="hljs-params">(Chatroom chatroom)</span> &#123;<br>        <span class="hljs-built_in">this</span>.chatroom = chatroom;<br>        <span class="hljs-comment">// 把自己加入观察者队列</span><br>        chatroom.addUser(<span class="hljs-built_in">this</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 接收信息</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">receive</span><span class="hljs-params">(String msg)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 微信客户端（具体订阅者）</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WxClient</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WxUser</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WxClient</span><span class="hljs-params">(Chatroom chatroom)</span> &#123;<br>        <span class="hljs-built_in">super</span>(chatroom);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">receive</span><span class="hljs-params">(String msg)</span> &#123;<br>        System.out.println(<span class="hljs-built_in">this</span>.toString() + <span class="hljs-string">&quot;: 接收到群消息：&quot;</span> + msg);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Chatroom</span> <span class="hljs-variable">chatroom</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Chatroom</span>();<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">WxUser</span>(chatroom);<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">WxUser</span>(chatroom);<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">WxUser</span>(chatroom);<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">WxUser</span>(chatroom);<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">WxUser</span>(chatroom);<br><br>        chatroom.sendMsg(<span class="hljs-string">&quot;Hello!&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">// 输出</span><br>WxUser@4f933fd1: 接收到群消息：Hello!<br>WxUser@548a9f61: 接收到群消息：Hello!<br>WxUser@1753acfe: 接收到群消息：Hello!<br>WxUser@7c16905e: 接收到群消息：Hello!<br>WxUser@2a2d45ba: 接收到群消息：Hello!<br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p><strong>Spring</strong></p><p>Spring的事件体系就是使用观察者模式，可以通过自定义<code>事件</code> <code>事件发布者(主题)</code> <code>事件监听器(观察者)</code></p><p>参考：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000037666661">https://segmentfault.com/a/1190000037666661</a></p><p><strong>Zookeeper</strong></p><p>zk客户端对服务端的某个节点进行监听，也是使用观察者思想</p></blockquote><h4 id="备忘录"><a class="markdownIt-Anchor" href="#备忘录"></a> 备忘录</h4><blockquote><p><code>快照数据，可进行撤回操作</code> <code>DB的binlog日志</code> <code>IDEA的撤回功能</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li>保存一个对象的某个状态，以便在适当的时候恢复对象</li></ul><hr><p><strong>适用场景</strong></p><ul><li>保存及恢复数据相关业务场景</li><li>后悔的时候，即想恢复到之前的状态</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>为用户提供一种可恢复机制</li><li>存档信息的封装</li></ul><p>缺点</p><ul><li>资源占用，如果类的成员变量过多，势必会占用比较大的资源，而且每一次保存都会消耗一定的内存</li></ul><hr><p><strong>与其他设计模式对比</strong></p><p><code>备忘录模式和状态模式</code></p><ul><li>备忘录模式：使用实例表示状态，我们的存档是对象的一个实例</li><li><a href="#%E7%8A%B6%E6%80%81">状态模式</a>：用类表示状态</li></ul><hr><p><strong>模拟场景</strong></p><p>论坛发表留言时，可以暂存草稿。下次重新进入当前主题后又可以重新加载暂存草稿继续发言</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%A4%87%E5%BF%98%E5%BD%95UML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 留言消息</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ToString</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Message</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Message</span><span class="hljs-params">(String title, String content)</span> &#123;<br>        <span class="hljs-built_in">this</span>.title = title;<br>        <span class="hljs-built_in">this</span>.content = content;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String title;<br>    <span class="hljs-keyword">private</span> String content;<br><br>    <span class="hljs-comment">// 进行快照</span><br>    <span class="hljs-keyword">public</span> MessageSnapshot <span class="hljs-title function_">snapshot</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageSnapshot</span>(<span class="hljs-built_in">this</span>.title, <span class="hljs-built_in">this</span>.content);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 留言消息快照,快照数据不提供set方法，不允许修改</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Getter</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageSnapshot</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MessageSnapshot</span><span class="hljs-params">(String title, String content)</span> &#123;<br>        <span class="hljs-built_in">this</span>.title = title;<br>        <span class="hljs-built_in">this</span>.content = content;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String title;<br>    <span class="hljs-keyword">private</span> String content;<br><br>    <span class="hljs-comment">// 快照数据进行转换</span><br>    <span class="hljs-keyword">public</span> Message <span class="hljs-title function_">change</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-built_in">this</span>.title, <span class="hljs-built_in">this</span>.content);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 消息快照管理</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageSnapshotManager</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Stack&lt;MessageSnapshot&gt; snapshotContainer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(MessageSnapshot messageSnapshot)</span> &#123;<br>        <span class="hljs-built_in">this</span>.snapshotContainer.push(messageSnapshot);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> MessageSnapshot <span class="hljs-title function_">getSnapshot</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.snapshotContainer.pop();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">&quot;title A&quot;</span>, <span class="hljs-string">&quot;回复内容 A&quot;</span>);<br><br>        <span class="hljs-comment">// 快照，保存草稿</span><br>        <span class="hljs-type">MessageSnapshot</span> <span class="hljs-variable">snapshot</span> <span class="hljs-operator">=</span> message.snapshot();<br>        <span class="hljs-type">MessageSnapshotManager</span> <span class="hljs-variable">manager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageSnapshotManager</span>();<br>        manager.save(snapshot);<br><br>        System.out.println(<span class="hljs-string">&quot;记录草稿，离开页面&quot;</span>);<br>        message = <span class="hljs-literal">null</span>;<br><br>        System.out.println(<span class="hljs-string">&quot;重新进入页面获取草稿&quot;</span>);<br>        snapshot = manager.getSnapshot();<br>        message = snapshot.change();<br>        System.out.println(message);<br>    &#125;<br>&#125;<br><span class="hljs-comment">// 输出</span><br>记录草稿，离开页面<br>重新进入页面获取草稿<br>Message(title=title A, content=回复内容 A)<br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p><strong>JDK</strong></p><ul><li>JDK的序列化<code>Serializable</code>，可以将一个对象进行序列化后保存在磁盘的文件中，待下次使用时进行反序列化</li></ul><p><strong>Mysql</strong></p><ul><li>Mysql每次提交事务前都会记录 binlog 以便于事务回滚</li></ul></blockquote><h4 id="命令"><a class="markdownIt-Anchor" href="#命令"></a> 命令</h4><blockquote><p><code>Linux命令执行</code> <code>操作参数化</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li>将请求转换为一个包含与请求相关的所有信息的独立对象，该转换让你能根据不同的请求将方法参数化、 延迟请求执行或将其放入队列中， 且能实现可撤销操作</li><li>命令模式解决了应用程序中对象的职责以及它们之间的通信方式</li></ul><hr><p><strong>适用场景</strong></p><ul><li>如果你需要通过操作来参数化对象， 可使用命令模式（将操作封装成独立对象，对象作为参数传递）</li><li>如果你想要将操作放入队列中、 操作的执行或者远程执行操作， 可使用命令模式</li><li>如果你想要实现操作撤回功能， 可使用命令模式</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>降低耦合</li><li>容易扩展新命令或者一组命令</li></ul><p>缺点</p><ul><li>命令的无限扩展会增加类的数量，提高系统实现复杂度</li></ul><hr><p><strong>角色说明</strong></p><ul><li><code>命令接口</code>：通常仅声明一个执行命令的方法</li><li><code>具体命令</code>：会实现各种类型的请求。 具体命令自身并不完成工作， 而是会将调用委派给一个业务逻辑对象</li><li><code>接收者类</code>：包含部分业务逻辑。 几乎任何对象都可以作为接收者。 绝大部分命令只处理如何将请求传递到接收者的细节， 接收者自己会完成实际的工作</li><li><code>发送者类</code>：负责对请求进行初始化， 其中必须包含一个成员变量来存储对于命令对象的引用。 发送者触发命令， 而不向接收者直接发送请求</li></ul><hr><p><strong>与其他设计模式对比</strong></p><p><code>命令模式和备忘录模式</code></p><p>命令模式和<a href="#%E5%A4%87%E5%BF%98%E5%BD%95">备忘录模式</a>经常结合使用，可以使用备忘录模式保存命令的历史记录，这样我们就可以直接调取上一个命令或历史执行过的命令（Linux的控制台）</p><hr><p><strong>模拟场景</strong></p><p>模拟小度的语音交互，回家时使用语音命令让小度打开电灯，睡觉时让小度关闭电灯</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8FUML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 命令接口</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Command</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 开灯命令（具体命令）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LightOnCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Command</span> &#123;<br>    <span class="hljs-keyword">private</span> Light light;<br>    <span class="hljs-comment">// 语音</span><br>    <span class="hljs-keyword">private</span> String voice;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LightOnCommand</span><span class="hljs-params">(Light light, String voice)</span> &#123;<br>        <span class="hljs-built_in">this</span>.light = light;<br>        <span class="hljs-built_in">this</span>.voice = voice;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;接收语音命令：&quot;</span> + voice);<br>        light.on();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 关灯命令（具体命令）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LightOffCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Command</span> &#123;<br>    <span class="hljs-keyword">private</span> Light light;<br>    <span class="hljs-comment">// 语音</span><br>    <span class="hljs-keyword">private</span> String voice;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LightOffCommand</span><span class="hljs-params">(Light light, String voice)</span> &#123;<br>        <span class="hljs-built_in">this</span>.light = light;<br>        <span class="hljs-built_in">this</span>.voice = voice;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;接收语音命令：&quot;</span> + voice);<br>        light.off();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 电灯（接收者类）</span><br><span class="hljs-comment"> * 命令模式好处是随着电灯操作的增加，只需要扩展相应的Command</span><br><span class="hljs-comment"> * 客户端使用不用发生改变</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Light</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">on</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;接收开灯命令，正在打开电灯&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">off</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;接收段等命令，正在关闭电灯&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 小度智能语音（发送者）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XiaoDu</span> &#123;<br>    <span class="hljs-keyword">private</span> List&lt;Command&gt; commandList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-comment">// 接收命令</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">receiveCommand</span><span class="hljs-params">(Command command)</span> &#123;<br>        <span class="hljs-built_in">this</span>.commandList.add(command);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeCommands</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">for</span> (Command command : commandList) &#123;<br>            command.execute();<br>        &#125;<br>        <span class="hljs-comment">// 命令执行完成后清除</span><br>        commandList.clear();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Light</span> <span class="hljs-variable">light</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Light</span>();<br>        <span class="hljs-type">XiaoDu</span> <span class="hljs-variable">xiaoDu</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XiaoDu</span>();<br><br>        <span class="hljs-comment">// 回家</span><br>        xiaoDu.receiveCommand(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LightOnCommand</span>(light, <span class="hljs-string">&quot;小度小度，开灯&quot;</span>));<br>        <span class="hljs-comment">// 可以一次性执行多条命令</span><br>        xiaoDu.executeCommands();<br><br>        <span class="hljs-comment">// 准备睡觉</span><br>        xiaoDu.receiveCommand(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LightOffCommand</span>(light, <span class="hljs-string">&quot;小度小度，关灯&quot;</span>));<br>        xiaoDu.executeCommands();<br>    &#125;<br>&#125;<br><span class="hljs-comment">//输出</span><br>接收语音命令：小度小度，开灯<br>接收开灯命令，正在打开电灯<br>接收语音命令：小度小度，关灯<br>接收段等命令，正在关闭电灯<br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p><strong>JDK</strong></p><p>JDK的<code>Runnable</code>接口其实就是一个抽象的命令，实现它的过程其实就是定义了一系列命令后，让线程(新建或线程池的线程)去执行你定义的命令(实现的run方法)</p></blockquote><h4 id="中介者"><a class="markdownIt-Anchor" href="#中介者"></a> 中介者</h4><blockquote><p><code>整理无序的依赖关系</code> <code>一对多转一对一</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%B8%AD%E4%BB%8B%E8%80%851.png" srcset="/img/loading.gif" lazyload alt></div><div class="group-image-wrap"><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%B8%AD%E4%BB%8B%E8%80%852.png" srcset="/img/loading.gif" lazyload alt></div></div></div><p><strong>定义</strong></p><p>能让你减少对象之间混乱无序的依赖关系。 该模式会限制对象之间的直接交互， 迫使它们通过一个中介者对象进行合作</p><hr><p><strong>适用场景</strong></p><ul><li>当一些对象和其他对象紧密耦合以致难以对其进行修改时， 可使用中介者模式</li><li>当组件因过于依赖其他组件而无法在不同应用中复用时， 可使用中介者模式</li><li>如果为了能在不同情景下复用一些基本行为， 导致你需要被迫创建大量组件子类时， 可使用中介者模式</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>将一对多转化成了一对一、降低程序复杂度</li><li>类之间解耦</li></ul><p>缺点</p><ul><li>中介者过多，导致系统复杂</li></ul><hr><p><strong>角色说明</strong></p><ul><li><code>组件</code>：是各种包含业务逻辑的类。 每个组件都有一个指向中介者的引用， 该引用被声明为中介者接口类型</li><li><code>中介者接口</code>：声明了与组件交流的方法， 但通常仅包括一个通知方法。 组件可将任意上下文 （包括自己的对象） 作为该方法的参数， 只有这样接收组件和发送者类之间才不会耦合</li><li><code>具体中介者</code>：封装了多种组件间的关系。 具体中介者通常会保存所有组件的引用并对其进行管理， 甚至有时会对其生命周期进行管理</li></ul><hr><p><strong>与其他设计模式对比</strong></p><p><code>中介者模式和观察者模式</code></p><p>某些场景这两种模式会结合适用，使用<a href="#%E8%A7%82%E5%AF%9F%E8%80%85">观察者模式</a>实现中介者模式角色之间的通讯</p><hr><p><strong>模拟场景</strong></p><p>手机有闹钟，音乐播放，视频播放功能，手机就像这些功能的中介者整合了这些功能。比如我们可以设置一个闹钟提醒我们及时观看时下正在热播的连续剧</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%B8%AD%E4%BB%8B%E8%80%85UML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* 功能（抽象组件）</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Function</span> &#123;<br> 	<span class="hljs-keyword">void</span> <span class="hljs-title function_">onEvent</span><span class="hljs-params">(Mobile mobile)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* 闹钟功能（具体组件）</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlarmFunction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Function</span> &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onEvent</span><span class="hljs-params">(Mobile mobile)</span> &#123;<br>    <span class="hljs-comment">// 使用中介者</span><br>    mobile.doEvent(<span class="hljs-string">&quot;alarm&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">alarm</span><span class="hljs-params">()</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;闹钟触发时间到&quot;</span>);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* 放音乐功能（具体组件）</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MusicFunction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Function</span> &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onEvent</span><span class="hljs-params">(Mobile mobile)</span> &#123;<br>    <span class="hljs-comment">// 使用中介者</span><br>    mobile.doEvent(<span class="hljs-string">&quot;music&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">playMusic</span><span class="hljs-params">()</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;播放音乐&quot;</span>);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* 看视频功能（具体组件）</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoFunction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Function</span> &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onEvent</span><span class="hljs-params">(Mobile mobile)</span> &#123;<br>    <span class="hljs-comment">// 使用中介者</span><br>    mobile.doEvent(<span class="hljs-string">&quot;video&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">playVideo</span><span class="hljs-params">()</span> &#123;<br>   System.out.println(<span class="hljs-string">&quot;播放视频&quot;</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* 中介（具体中介者）</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Mobile</span> &#123;<br><span class="hljs-keyword">private</span> AlarmFunction alarmFunction;<br><span class="hljs-keyword">private</span> MusicFunction musicDemand;<br><span class="hljs-keyword">private</span> VideoFunction videoDemand;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Mobile</span><span class="hljs-params">(AlarmFunction alarmFunction, MusicFunction musicDemand, VideoFunction videoDemand)</span> &#123;<br>   <span class="hljs-built_in">this</span>.alarmFunction = alarmFunction;<br>   <span class="hljs-built_in">this</span>.musicDemand = musicDemand;<br>   <span class="hljs-built_in">this</span>.videoDemand = videoDemand;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doEvent</span><span class="hljs-params">(String type)</span> &#123;<br>   <span class="hljs-keyword">switch</span> (type) &#123;<br>       <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;alarm&quot;</span>:<br>           doAlarmEvent();<br>           <span class="hljs-keyword">break</span>;<br>       <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;video&quot;</span>:<br>           doVideoEvent();<br>           <span class="hljs-keyword">break</span>;<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">// 提醒及时观看连续剧,通过中介者完成多个组件的依赖调用</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doAlarmEvent</span><span class="hljs-params">()</span> &#123;<br>   alarmFunction.alarm();<br>   musicDemand.playMusic();<br>   videoDemand.playVideo();<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doVideoEvent</span><span class="hljs-params">()</span> &#123;<br>   <span class="hljs-comment">// TODO 看视频设置音量</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">AlarmFunction</span> <span class="hljs-variable">alarmFunction</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlarmFunction</span>();<br>    <span class="hljs-type">MusicFunction</span> <span class="hljs-variable">musicFunction</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MusicFunction</span>();<br>    <span class="hljs-type">VideoFunction</span> <span class="hljs-variable">videoFunction</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VideoFunction</span>();<br>    <span class="hljs-type">Mobile</span> <span class="hljs-variable">mobile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mobile</span>(alarmFunction, musicFunction, videoFunction);<br><br>    <span class="hljs-comment">// 闹钟提醒观看连续剧（通过中介者操作其他组件）</span><br>    alarmFunction.onEvent(mobile);<br>	&#125;<br>&#125;<br><span class="hljs-comment">// 输出</span><br>闹钟触发时间到<br>播放音乐<br>播放视频<br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p><strong>JDK</strong></p><p>JDK的反射机制我们非常熟悉，<code>Method#invoke</code>可以反射调用某个对象的方法，实际上调用的是第一个参数obj对象的一个成员方法，而非<code>Method</code>实现方法。<code>Method</code>在反射中起到中介作用</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%B8%AD%E4%BB%8B%E8%80%85Method.png" srcset="/img/loading.gif" lazyload alt></p></blockquote><h4 id="责任链"><a class="markdownIt-Anchor" href="#责任链"></a> 责任链</h4><blockquote><p><code>链式执行</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li><p>为了避免请求发送者与多个请求处理者耦合在一起，于是将所有请求的处理者通过前一对象记住其下一个对象的引用而连成一条链</p></li><li><p>当有请求发生时，可将请求沿着这条链传递，直到有对象处理它为止</p></li></ul><hr><p><strong>适用场景</strong></p><ul><li>当程序需要使用不同方式处理不同种类请求， 而且请求类型和顺序预先未知时， 可以使用责任链模式</li><li>当必须按顺序执行多个处理者时， 可以使用该模式</li><li>如果所需处理者及其顺序必须在运行时进行改变， 可以使用责任链模式</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>请求的发送者和接收者(请求的处理)解耦</li><li>责任链可以动态组合</li></ul><p>缺点</p><ul><li>责任链太长或者处理时间过长，影响性能</li><li>责任链有可能过多</li></ul><hr><p><strong>与其他设计模式对比</strong></p><p><code>责任链模式和状态模式</code></p><ul><li>责任链模式：在责任链模式中，各个对象并不指定下一个处理的对象者是谁，只有在客户端中设置了处理对象的顺序，直到被某个对象处理或整个链条结束</li><li><a href="#%E7%8A%B6%E6%80%81">状态模式</a>：每个状态对象知道自己下一个处理的对象是谁</li></ul><hr><p><strong>模拟场景</strong></p><p>网站用户注册时，校验用户名是否为一个正确的邮箱格式，密码长度是否大于6位，否则就抛出异常让用户重新填写</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 用户</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> String password;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 验证处理器</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VerifyHandler</span> &#123;<br>    <span class="hljs-keyword">private</span> VerifyHandler next;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">verify</span><span class="hljs-params">(User user)</span> &#123;<br>        handler(user);<br>        <span class="hljs-keyword">if</span> (Objects.nonNull(<span class="hljs-built_in">this</span>.next)) &#123;<br>            <span class="hljs-built_in">this</span>.next.verify(user);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 处理</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handler</span><span class="hljs-params">(User user)</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNext</span><span class="hljs-params">(VerifyHandler next)</span> &#123;<br>        <span class="hljs-built_in">this</span>.next = next;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 邮箱验证</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmailHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">VerifyHandler</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handler</span><span class="hljs-params">(User user)</span> &#123;<br>        <span class="hljs-keyword">if</span> (Objects.isNull(user.getUsername())) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">&quot;邮箱为空&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;^([a-zA-Z0-9]*[-_]?[a-zA-Z0-9]+)*@([a-zA-Z0-9]*[-_]?[a-zA-Z0-9]+)+[\\.][A-Za-z]&#123;2,3&#125;([\\.][A-Za-z]&#123;2&#125;)?$&quot;</span>;<br>        <span class="hljs-type">Pattern</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> Pattern.compile(str);<br>        <span class="hljs-type">Matcher</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> p.matcher(user.getUsername());<br><br>        <span class="hljs-keyword">if</span> (!m.matches()) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;邮箱格式不合法&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 密码验证</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PasswordHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">VerifyHandler</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handler</span><span class="hljs-params">(User user)</span> &#123;<br>        <span class="hljs-keyword">if</span> (Objects.isNull(user.getPassword())) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">&quot;密码不能为空&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (user.getPassword().length() &lt; <span class="hljs-number">6</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;密码长度必须超过6位&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 创建责任链</span><br>        <span class="hljs-type">VerifyHandler</span> <span class="hljs-variable">emailHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EmailHandler</span>();<br>        <span class="hljs-type">VerifyHandler</span> <span class="hljs-variable">passwordHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PasswordHandler</span>();<br>        emailHandler.setNext(passwordHandler);<br><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;test@test.com&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>);<br>        emailHandler.verify(user);<br><br>        <span class="hljs-comment">// 输出 Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: 密码长度必须超过6位</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p><strong>Spring MVC</strong></p><p>Spring MVC 源码中大量使用了责任链模式，比如<code>请求-&gt;方法</code>调用的映射，还有自定义拦截器<code>HandlerInterceptor</code></p><p><code>DispatcherServlet#doDispatch</code>在处理请求时会先获取拦截器链</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%B4%A3%E4%BB%BB%E9%93%BESpringMVC.png" srcset="/img/loading.gif" lazyload alt></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%B4%A3%E4%BB%BB%E9%93%BESpringMVC2.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>Spring security</strong></p><p>Spring security的权限验证体系也是使用责任链完成的</p></blockquote><h4 id="访问者"><a class="markdownIt-Anchor" href="#访问者"></a> 访问者</h4><blockquote><p><code>低频使用</code> <code>数据的操作被重定向到访问者</code> <code>数据结构与数据操作分离</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><ul><li>它能将算法与其所作用的对象隔离开来</li></ul><hr><p><strong>适用场景</strong></p><ul><li>如果你需要对一个复杂对象结构中的所有元素执行某些操作， 可使用访问者模式</li><li>当某个行为仅在类层次结构中的一些类中有意义， 而在其他类中没有意义时， 可使用该模式</li><li>数据结构与数据操作分离</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>增加新的操作很容易,即增加一个新的访问者</li></ul><p>缺点</p><ul><li>增加新的数据结构困难</li><li>具体元素变更比较麻烦</li></ul><hr><p><strong>角色说明</strong></p><ul><li><code>元素接口</code>：声明了一个方法来 “接收” 访问者。 该方法必须有一个参数被声明为访问者接口类型</li><li><code>具体元素</code>：必须实现接收方法。 该方法的目的是根据当前元素类将其调用重定向到相应访问者的方法</li><li><code>访问者接口</code>：声明了一系列以对象结构的具体元素为参数的访问者方法。 如果编程语言支持重载， 这些方法的名称可以是相同的， 但是其参数一定是不同的</li><li><code>具体访问者</code>：会为不同的具体元素类实现相同行为的几个不同版本</li></ul><hr><p><strong>与其他设计模式对比</strong></p><p><code>访问者模式和迭代器模式</code></p><ul><li><p>共同点：都是在某种数据结构上进行一些处理</p></li><li><p>访问者：主要对保存在数据结构中的元素进行某种特定的处理，重点是处理</p></li><li><p><a href="#%E8%BF%AD%E4%BB%A3%E5%99%A8">迭代器</a>：主要是逐个遍历保存在数据结构中的一些元素，重点是遍历</p></li></ul><hr><p><strong>模拟场景</strong></p><p>计算机零件有键盘、鼠标、内存、磁盘。电脑可以访问这些零件执行一些操作</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8FUML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 电脑零件（元素接口）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ComputerPart</span> &#123;<br>    <span class="hljs-comment">// 接受访问</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Visitor visitor)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 键盘（具体元素）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Keyboard</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ComputerPart</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Visitor visitor)</span> &#123;<br>        <span class="hljs-comment">// 调用访问者进行访问</span><br>        visitor.visit(<span class="hljs-built_in">this</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 鼠标（具体元素）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Mouse</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ComputerPart</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Visitor visitor)</span> &#123;<br>        <span class="hljs-comment">// 调用访问者进行访问 内存</span><br>        visitor.visit(<span class="hljs-built_in">this</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 内存（具体元素）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Memory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ComputerPart</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Visitor visitor)</span> &#123;<br>        <span class="hljs-comment">// 调用访问者进行访问</span><br>        visitor.visit(<span class="hljs-built_in">this</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 磁盘（具体元素）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Disk</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ComputerPart</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Visitor visitor)</span> &#123;<br>        <span class="hljs-comment">// 调用访问者进行访问</span><br>        visitor.visit(<span class="hljs-built_in">this</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 访问者（访问者接口）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Visitor</span> &#123;<br><br>    <span class="hljs-comment">// 访问键盘</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Keyboard keyboard)</span>;<br><br>    <span class="hljs-comment">// 访问鼠标</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Mouse mouse)</span>;<br><br>    <span class="hljs-comment">// 访问内存</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Memory memory)</span>;<br><br>    <span class="hljs-comment">// 访问磁盘</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Disk disk)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 电脑（具体访问者）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Computer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Visitor</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Keyboard keyboard)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;访问键盘 亮起键盘灯&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Mouse mouse)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;访问鼠标 亮起鼠标灯&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Memory memory)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;访问内存 写入内存数据&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Disk disk)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;访问磁盘 写入文件&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        List&lt;ComputerPart&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Keyboard</span>());<br>        list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Mouse</span>());<br>        list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Memory</span>());<br>        list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Disk</span>());<br><br>        <span class="hljs-comment">// 访问者，实现访问不同数据结构的操作</span><br>        <span class="hljs-type">Visitor</span> <span class="hljs-variable">visitor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Computer</span>();<br><br>        <span class="hljs-keyword">for</span> (ComputerPart computerPart : list) &#123;<br>            computerPart.accept(visitor);<br>        &#125;<br><br><span class="hljs-comment">//        输出</span><br><span class="hljs-comment">//        访问键盘 亮起键盘灯</span><br><span class="hljs-comment">//        访问鼠标 亮起鼠标灯</span><br><span class="hljs-comment">//        访问内存 写入内存数据</span><br><span class="hljs-comment">//        访问磁盘 写入文件</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p><strong>JDK</strong></p><p>JDK nio包下的<code>FileVisitor</code>文件访问者接口，提供文件的访问和遍历操作</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BF%E9%97%AE%E8%80%85NIO.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>Spring</strong></p><p>Spring的<code>BeanDefinitionVisitor</code>用于遍历bean中的属性值和构造参数值，解析bean的元数据值</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8FSpring.png" srcset="/img/loading.gif" lazyload alt></p></blockquote><h4 id="状态"><a class="markdownIt-Anchor" href="#状态"></a> 状态</h4><blockquote><p><code>将状态封装成对象并处理特定逻辑，上下文简化调用。实际业务处理由上下文重定向到状态对象</code></p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt></p><p><strong>定义</strong></p><p>允许一个对象在其内部状态改变时,改变它的行为</p><hr><p><strong>适用场景</strong></p><ul><li>如果对象需要根据自身当前状态进行不同行为， 同时状态的数量非常多且与状态相关的代码会频繁变更的话， 可使用状态模式</li><li>如果某个类需要根据成员变量的当前值改变自身行为， 从而需要使用大量的条件语句时， 可使用该模式</li><li>当相似状态和基于条件的状态机转换中存在许多重复代码时， 可使用状态模式</li></ul><hr><p><strong>优缺点</strong></p><p>优点</p><ul><li>将不同的状态隔离</li><li>把各种状态的转换逻辑，分布到State的子类中，减少相互间依赖</li><li>增加新的状态非常简单</li></ul><p>缺点</p><ul><li>状态多的业务场景导致类数目增加，系统变复杂</li></ul><hr><p><strong>角色说明</strong></p><ul><li><code>状态接口</code>：声明特定于状态的方法。 这些方法应能被其他所有具体状态所理解， 因为你不希望某些状态所拥有的方法永远不会被调用</li><li><code>具体状态</code>：会自行实现特定于状态的方法。 为了避免多个状态中包含相似代码， 你可以提供一个封装有部分通用行为的中间抽象类</li><li><code>上下文</code>：保存了对于一个具体状态对象的引用， 并会将所有与该状态相关的工作委派给它。 上下文通过状态接口与状态对象交互， 且会提供一个设置器用于传递新的状态对象</li></ul><hr><p><strong>与其他设计模式对比</strong></p><p><code>状态模式和享元模式</code></p><p>状态模式和<a href="#%E4%BA%AB%E5%85%83">享元模式</a>在特定场景可以配合使用，使用享元模式在多个上下文之间共享状态实例</p><hr><p><strong>场景模拟</strong></p><p>地铁自定义有五种状态：运行、停止、开门、关门、异常、，每个状态执行不同的方法能够改变状态，并且不同的状态只能能执行特定的方法</p><p><img src="/2022/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8FUML.png" srcset="/img/loading.gif" lazyload alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 基础状态（状态接口）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span> &#123;<br>	<span class="hljs-comment">// 状态持有上下文，当状态改变时才能委托给上下文</span><br>    <span class="hljs-keyword">private</span> Subway context;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContext</span><span class="hljs-params">(Subway context)</span> &#123;<br>        <span class="hljs-built_in">this</span>.context = context;<br>    &#125;<br><br>    <span class="hljs-comment">// 以下方法都是帮助上下文切换状态并触发上下文执行</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 切换上下文状态</span><br>        <span class="hljs-built_in">this</span>.context.setState(Subway.RUN_STATE);<br>        <span class="hljs-comment">// 将业务逻辑委托给上下文，上下文再委托给当前状态</span><br>        <span class="hljs-built_in">this</span>.context.run();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.context.setState(Subway.STOP_STATE);<br>        <span class="hljs-built_in">this</span>.context.stop();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.context.setState(Subway.OPEN_STATE);<br>        <span class="hljs-built_in">this</span>.context.open();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.context.setState(Subway.CLOSE_STATE);<br>        <span class="hljs-built_in">this</span>.context.close();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">error</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.context.setState(Subway.ERROR_STATE);<br>        <span class="hljs-built_in">this</span>.context.error();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 地铁运行状态（具体状态）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RunState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;地铁运行，前往下一个地铁站&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 控制 run -&gt; open 不能切换,如果切换则跳转到异常状态</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.context.setState(Subway.ERROR_STATE);<br>        <span class="hljs-built_in">super</span>.context.open();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 地铁停止状态（具体状态）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StopState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;地铁进站&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 地铁开门状态（具体状态）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OpenState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;地铁开门&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 地铁停止状态（具体状态）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CloseState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;地铁关门&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 地铁异常状态（具体状态）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ErrorState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;异常警告！，不能启动&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;异常警告！，不能停止&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;异常警告！，不能开门&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;异常警告！，不能关门&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">error</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;异常警告！&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 地铁 （上下文) </span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Subway</span> &#123;<br>    <span class="hljs-comment">// 定义状态</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">RunState</span> <span class="hljs-variable">RUN_STATE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RunState</span>();<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">StopState</span> <span class="hljs-variable">STOP_STATE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StopState</span>();<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">OpenState</span> <span class="hljs-variable">OPEN_STATE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenState</span>();<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">CloseState</span> <span class="hljs-variable">CLOSE_STATE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CloseState</span>();<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">ErrorState</span> <span class="hljs-variable">ERROR_STATE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ErrorState</span>();<br><br><br>    <span class="hljs-comment">// 当前地铁状态</span><br>    <span class="hljs-keyword">private</span> State state;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setState</span><span class="hljs-params">(State state)</span> &#123;<br>        <span class="hljs-comment">// 切换上下文状态</span><br>        <span class="hljs-built_in">this</span>.state = state;<br>        <span class="hljs-comment">// 设置上下文</span><br>        state.setContext(<span class="hljs-built_in">this</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 以下方法上下文都会委托给当前状态处理</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.state.run();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.state.stop();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.state.open();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.state.close();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">error</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.state.error();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 初始化上下文</span><br>        <span class="hljs-type">Subway</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subway</span>();<br>        context.setState(Subway.STOP_STATE);<br><br>        <span class="hljs-comment">// 上下文状态切换，具体实现由对应的State实现</span><br>        context.open();<br>        context.close();<br>        context.run();<br>        context.open();<br><br>        <span class="hljs-comment">// 输出</span><br>        <span class="hljs-comment">// 地铁开门</span><br>        <span class="hljs-comment">// 地铁关门</span><br>        <span class="hljs-comment">// 地铁运行，前往下一个地铁站</span><br>        <span class="hljs-comment">// 异常警告！，不能开门</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>源码解析</strong></p><p>状态模式一般结合业务模式开发</p></blockquote><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></div><hr><div><div class="post-metas my-3"></div><div class="license-box my-3"><div class="license-title"><div>设计模式</div><div>https://wugengfeng.cn/2022/04/23/设计模式/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>wugengfeng</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2022年4月23日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2022/05/01/elasticsearch/" title="Elasticsearch"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Elasticsearch</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2022/04/13/java%E6%BA%90%E7%A0%81/" title="java源码"><span class="hidden-mobile">java源码</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,i=t.getElementById("subtitle");i&&e&&e(i.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;0<t.find(".toc-list-item").length&&t.css("visibility","visible")}}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>